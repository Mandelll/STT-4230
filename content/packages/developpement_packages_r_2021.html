---
title: "Développement de packages R"
author: "Sophie Baillargeon, Université Laval"
date: "2021-03-29"
weight: 2
slug: "devel_packages_r"
lastmodifierdisplayname: "Sophie Baillargeon"
lastmodifieremail: "sophie.baillargeon@mat.ulaval.ca"
output:
  pdf_document:
    toc: yes
    toc_depth: 3
    number_sections: yes
    highlight: tango
  blogdown::html_page:
    toc: yes
    toc_depth: 3
    number_sections: yes
    highlight: tango
header-includes:
- \usepackage[french]{babel}
- \frenchbsetup{StandardLayout}
- \hypersetup{colorlinks=true, urlcolor = {blue}, linkcolor = {blue}}
- \DeclareUnicodeCharacter{2714}{-}
- \DeclareUnicodeCharacter{221A}{-}
- \DeclareUnicodeCharacter{25CF}{*}
editor_options: 
  chunk_output_type: console
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<div id="TOC">
<ul>
<li><a href="#étape-1.-écrire-les-fonctions"><span class="toc-section-number">1</span> Étape 1. Écrire les fonctions</a></li>
<li><a href="#étape-2.-créer-larborescence-de-répertoires-et-fichiers-du-package"><span class="toc-section-number">2</span> Étape 2. Créer l’arborescence de répertoires et fichiers du package</a>
<ul>
<li><a href="#répertoire-principal-portant-le-nom-du-package"><span class="toc-section-number">2.1</span> Répertoire principal portant le nom du package</a></li>
<li><a href="#sous-répertoire-r"><span class="toc-section-number">2.2</span> Sous-répertoire <code>R/</code></a></li>
<li><a href="#sous-répertoire-data"><span class="toc-section-number">2.3</span> Sous-répertoire <code>data/</code></a></li>
<li><a href="#sous-répertoire-man"><span class="toc-section-number">2.4</span> Sous-répertoire <code>man/</code></a></li>
<li><a href="#fichier-description"><span class="toc-section-number">2.5</span> Fichier <code>DESCRIPTION</code></a></li>
<li><a href="#fichier-namespace"><span class="toc-section-number">2.6</span> Fichier <code>NAMESPACE</code></a></li>
<li><a href="#autres-fichiers-et-répertoires"><span class="toc-section-number">2.7</span> Autres fichiers et répertoires</a></li>
</ul></li>
<li><a href="#étape-3.-écrire-la-documentation-des-fonctions-et-du-package"><span class="toc-section-number">3</span> Étape 3. Écrire la documentation des fonctions et du package</a>
<ul>
<li><a href="#documentation-avec-roxygen2"><span class="toc-section-number">3.1</span> Documentation avec <code>roxygen2</code></a></li>
<li><a href="#générer-les-fichiers-.rd-et-le-fichier-namespace"><span class="toc-section-number">3.2</span> Générer les fichiers .Rd et le fichier <code>NAMESPACE</code></a></li>
</ul></li>
<li><a href="#étape-4.-vérifier-et-construire-le-package"><span class="toc-section-number">4</span> Étape 4. Vérifier et construire le package</a>
<ul>
<li><a href="#lancement-des-commandes-de-vérification-et-de-construction-avec-devtools"><span class="toc-section-number">4.1</span> Lancement des commandes de vérification et de construction avec <code>devtools</code></a>
<ul>
<li><a href="#vérification-de-package-avec-la-fonction-devtoolscheck"><span class="toc-section-number">4.1.1</span> Vérification de package avec la fonction <code>devtools::check</code></a></li>
<li><a href="#construction-de-package-avec-la-fonction-devtoolsbuild"><span class="toc-section-number">4.1.2</span> Construction de package avec la fonction <code>devtools::build</code></a></li>
<li><a href="#accès-à-nos-fonctions-en-cours-de-développement"><span class="toc-section-number">4.1.3</span> Accès à nos fonctions en cours de développement</a></li>
</ul></li>
<li><a href="#lancement-des-commandes-de-vérification-et-de-construction-en-rstudio"><span class="toc-section-number">4.2</span> Lancement des commandes de vérification et de construction en RStudio</a></li>
</ul></li>
<li><a href="#étape-5.-si-désiré-partager-le-package"><span class="toc-section-number">5</span> Étape 5. Si désiré, partager le package</a></li>
<li><a href="#étape-6.-au-besoin-mettre-à-jour-le-package"><span class="toc-section-number">6</span> Étape 6. Au besoin, mettre à jour le package</a></li>
<li><a href="#résumé"><span class="toc-section-number">7</span> Résumé</a></li>
<li><a href="#références">Références</a></li>
<li><a href="#annexe">Annexe</a>
<ul>
<li><a href="#résolution-de-problèmes-déjà-rencontrés">Résolution de problèmes déjà rencontrés</a></li>
</ul></li>
</ul>
</div>

<hr />
<p><em>Note préliminaire : Lors de leur dernière mise à jour, ces notes ont été révisées en utilisant R version 4.0.3, le package <code>devtools</code> version 2.3.2, le package <code>usethis</code> version 2.0.1, le package <code>roxygen2</code> version 7.1.1 et le package <code>pkgbuild</code> version 1.2.0. Le package <code>ggplot2</code> version 3.3.3 aussi est utilisé dans un exemple. Pour d’autres versions, les informations peuvent différer.</em></p>
<hr />
<p>Les packages R sont le meilleur moyen de partager des fonctions R. Pour créer un package R, il faut d’abord développer une arborescence de répertoires et fichiers similaire à ce qui se retrouve dans n’importe quel <em>package source</em>. Pour voir de quoi a l’air une telle arborescence, il suffit de :</p>
<ul>
<li>télécharger un <em>package source</em> à partir du CRAN (par exemple <em>ggplot2_3.3.3.tar.gz</em> sur <a href="http://CRAN.R-project.org/package=ggplot2" class="uri">http://CRAN.R-project.org/package=ggplot2</a>),</li>
<li>décompresser le fichier (il y a 2 étapes de décompression à effectuer).</li>
</ul>
<p>L’exemple utilisé ici, soit le package <code>ggplot2</code>, est un gros package. L’arborescence de répertoires et fichiers formant son <em>package source</em> peut être représentée schématiquement comme suit :</p>
<pre><code>ggplot2/
  |-- build/
  |-- data/
  |-- inst/
  |-- man/
  |-- R/
  |-- tests/
  |-- vignettes/
  |-- DESCRIPTION
  |-- LICENSE
  |-- MD5
  |-- NAMESPACE
  |-- NEWS.md
  |-- README.md</code></pre>
<p>Seuls certains de ces répertoires (dénotés par le caractère <code>/</code> en suffixe) et fichiers sont nécessaires dans tout package R. Certains fichiers, tels que <code>DESCRIPTION</code> et <code>NAMESPACE</code>, sont obligatoires et doivent suivre une syntaxe particulière.</p>
<p>Après avoir développé les fichiers source, qui incluent le code source et de la documentation, il ne reste plus qu’à construire l’archive (fichier compressé) du package. Nous verrons ici comment réaliser toutes ces étapes.</p>
<div id="étape-1.-écrire-les-fonctions" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Étape 1. Écrire les fonctions</h1>
<p>La première étape, celle de l’écriture des fonctions, fait appel à ce que nous avons appris dans toutes les notes de cours précédentes, en particulier celles sur les <a href="https://stt4230.rbind.io/programmation/fonctions_r/">fonctions en R</a>.</p>
<p>Lorsque nous créons des fonctions dans le but de les inclure dans un package, il faut garder en tête le chemin de recherche complet qu’utilisera R lors de l’exécution de ces fonctions. Ce chemin est le suivant :</p>
<ol style="list-style-type: decimal">
<li>l’environnement local d’exécution de la fonction,</li>
<li>l’environnement englobant de la fonction, soit l’espace de noms du package,</li>
<li>l’environnement des objets importés par le package,</li>
<li>l’environnement du package R de base,</li>
<li>l’environnement de travail,</li>
<li>les environnements de tous les packages chargés.</li>
</ol>
<p>Nous savons déjà que, dans ce chemin de recherche, nous ne pouvons pas nous fier au contenu de l’environnement de travail, car il varie constamment en cours de session. Nous ne pouvons pas non plus nous fier aux packages chargés. En effet, la liste des packages chargés varie aussi en cours de session et d’un utilisateur à l’autre. Le bon fonctionnement des fonctions d’un package devrait dépendre d’un seul appel à la fonction <code>library</code>, celui servant à charger le package en question.</p>
<p>Ainsi, dans le corps des fonctions d’un package, nous pouvons toujours faire appel</p>
<ol style="list-style-type: decimal">
<li>aux arguments et variables locales,</li>
<li>à tout objet, public ou privé, contenu dans le package,</li>
<li>aux objets provenant d’autres packages qui sont importés par le package,</li>
<li>à des objets du package R de base, qui est toujours inclus dans le chemin de recherche.</li>
</ol>
<p>Nous verrons comment inclure des objets provenant d’autres packages dans <em>l’environnement des objets importés par le package</em>. Dans le corps de nos fonctions, il est recommandé de faire appel à ces objets en utilisant l’opérateur <code>::</code> pour indiquer clairement de quel package ils proviennent. Par exemple, si nous voulons utiliser la fonction <code>dist</code> du package <code>stats</code>, il est préférable de l’appeler comme suit : <code>stats::dist()</code>.</p>
<p>Aussi, si notre but est éventuellement de rendre notre package public sur le CRAN, il faut respecter les politiques du CRAN, présentées ici : <a href="http://cran.r-project.org/web/packages/policies.html" class="uri">http://cran.r-project.org/web/packages/policies.html</a>.<br />
La plus importante de ces politiques est que notre package doit <a href="https://cran.r-project.org/doc/manuals/r-release/R-exts.html#Checking-packages">passer le <code>R CMD check --as-cran</code></a> sans erreurs ni avertissements (nous en reparlons plus loin). Pour passer cette vérification sans problèmes, notre code <strong>ne</strong> devrait <strong>pas</strong>, notamment :</p>
<ul>
<li>contenir des symboles non-<a href="https://fr.wikipedia.org/wiki/American_Standard_Code_for_Information_Interchange">ASCII</a> (donc pas d’accents) :<br />
<em>afin de s’assurer que le code est fonctionnel sur n’importe quelle plateforme informatique</em>;</li>
<li>utiliser d’association partielle d’argument (donc nous devons utiliser le nom complet des arguments dans les appels de fonction) :<br />
<em>afin de s’assurer que le code demeure fonctionnel si des arguments sont ajoutés aux définitions des fonctions appelées dans le code (ces nouveaux arguments pourraient porter des noms qui entrent en conflit avec l’association partielle)</em>;</li>
<li>toujours utiliser comme valeurs logiques <code>TRUE</code> ou <code>FALSE</code> (donc pas de <code>T</code> ou <code>F</code>) :<br />
<em>parce qu’un objet R nommé</em> <code>T</code> <em>ou</em> <code>F</code> <em>peut être défini, écrasant du coup les définitions</em> <code>T &lt;- TRUE</code> <em>et</em> <code>F &lt;- FALSE</code>, <em>alors qu’il est impossible de créer un nouvel objet R nommé <code>TRUE</code> ou <code>FALSE</code> (mots-clés protégés)</em>;</li>
<li>contenir des exemples longs à rouler dans les fiches d’aide :<br />
<em>parce que les gestionnaires du CRAN roulent quotidiennement le</em> <code>R CMD check --as-cran</code> <em>sur tous les packages du CRAN, et cette vérification comprend l’exécution des exemples; étant donné le très grand nombre de packages sur le CRAN, la vérification de chaque package séparément doit être rapide</em>;</li>
<li>etc.</li>
</ul>
<p>Pour rendre un package disponible sur <a href="https://www.bioconductor.org/">Bioconductor</a>, encore plus de lignes directrices à suivre s’ajoutent (voir <a href="https://www.bioconductor.org/developers/package-guidelines/" class="uri">https://www.bioconductor.org/developers/package-guidelines/</a>).</p>
<div id="exemple" class="section level4 unnumbered">
<h4>Exemple :</h4>
<p></p>
<p>Dans ces notes, nous allons reprendre l’exemple de la fonction <code>dist_manhattan</code> qui calcule la distance de Manhattan entre deux points provenant des <a href="https://stt4230.rbind.io/programmation/tests_exceptions_r/">notes sur les tests et exceptions en R</a>. Modifions un peu la fonction <code>dist_manhattan</code> afin que les objets quelle retourne possèdent une classe. Ensuite, créons une fonction équivalente, nommée <code>dist_manhattan_2</code>, qui fait le même calcul, mais en appelant la fonction <code>dist</code> du package <code>stats</code>. L’objet retourné par cette fonction doit posséder la même classe qu’un objet retourné par <code>dist_manhattan</code>. Finalement, créons une méthode associée à cette classe pour la fonction générique <code>print</code> afin de formater l’impression d’un objet retourné par n’importe laquelle de nos deux fonctions. Voici le code source de ces fonctions, qui formeront le package que nous créerons.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>dist_manhattan <span class="ot">&lt;-</span> <span class="cf">function</span>(point1, point2) {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(point1) <span class="sc">!=</span> <span class="fu">length</span>(point2)) {</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;&#39;point1&#39; and &#39;point2&#39; must have the same length&quot;</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">dim</span>(point1)) <span class="sc">||</span> <span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">dim</span>(point2))) {</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="st">&quot;&#39;point1&#39; and &#39;point2&#39; are treated as dimension 1 vectors&quot;</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  sortie <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">dist =</span> <span class="fu">sum</span>(<span class="fu">abs</span>(point1 <span class="sc">-</span> point2)))</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(sortie) <span class="ot">&lt;-</span> <span class="st">&quot;distman&quot;</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(sortie)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>dist_manhattan_2 <span class="ot">&lt;-</span> <span class="cf">function</span>(point1, point2) {</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  call <span class="ot">&lt;-</span> <span class="fu">match.call</span>()</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  dist <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">dist</span>(<span class="fu">rbind</span>(point1, point2), <span class="at">method =</span> <span class="st">&quot;manhattan&quot;</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  sortie <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">dist =</span> <span class="fu">as.vector</span>(dist), <span class="at">call =</span> call)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(sortie) <span class="ot">&lt;-</span> <span class="st">&quot;distman&quot;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(sortie)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>print.distman <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ...) {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Manhattan distance between &#39;point1&#39; and &#39;point2&#39; :&quot;</span>, x<span class="sc">$</span>dist, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>, ...)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invisible</span>(x)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<div id="étape-2.-créer-larborescence-de-répertoires-et-fichiers-du-package" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Étape 2. Créer l’arborescence de répertoires et fichiers du package</h1>
<p>Un package, dans sa version source, est simplement une arborescence de répertoires et fichiers. Cependant, cette arborescence, ou structure, doit comprendre des fichiers et des sous-répertoires portant des noms et du contenu spécifiques.</p>
<p>Nous pouvons créer cette arborescence :</p>
<ul>
<li>manuellement (p. ex. dans un explorateur de fichiers offert par notre système d’exploitation),</li>
<li>en appelant la <a href="https://stat.ethz.ch/R-manual/R-patched/library/utils/html/package.skeleton.html">fonction <code>package.skeleton</code></a> du package <code>utils</code>,</li>
<li>en appelant la <a href="https://usethis.r-lib.org/reference/create_package.html">fonction <code>create_package</code></a> du package <code>usethis</code>, chargé lors du chargement du package <code>devtools</code> (ce que nous ferons),</li>
<li>en utilisant les fonctionnalités de création de projets RStudio (ce qui résulte en fait en l’utilisation du package <code>usethis</code>).</li>
</ul>
<p>Peu importe la procédure utilisée, il faut d’abord avoir un <strong>répertoire principal portant le nom du package</strong>. Le contenu de base d’un répertoire de package est le suivant :</p>
<ul>
<li>sous-répertoire nommé <code>R</code> : emplacement du code source R,</li>
<li>sous-répertoire nommé <code>man</code> : emplacement du code source des fiches d’aide,</li>
<li>fichier nommé <code>DESCRIPTION</code> : fichier de configuration,</li>
<li>fichier nommé <code>NAMESPACE</code> : définition de l’espace de noms et de l’environnement des objets importés.</li>
</ul>
<p>Nous pouvons représenter schématiquement ce contenu comme suit :</p>
<pre><code>&lt;nomPackage&gt;/
  |-- R/
  |-- man/
  |-- DESCRIPTION
  |-- NAMESPACE</code></pre>
<div id="package-devtools" class="section level4 unnumbered">
<h4>Package <code>devtools</code></h4>
<p></p>
<p>Concernant le <a href="https://devtools.r-lib.org/">package <code>devtools</code></a>, mentionnons qu’il comporte plusieurs fonctions facilitant la création et l’utilisation de packages R. Ce package est en quelque sorte sous-divisé en plus petits packages. Par exemple, les fonctions d’installation de package de <code>devtools</code> vues dans les <a href="https://stt4230.rbind.io/packages/utilisation_packages_r/#%C3%A0-partir-dun-d%C3%A9p%C3%B4t-informatique-autre-que-le-cran">notes sur l’utilisation de packages</a> (dont le nom débute par <code>install_</code>) proviennent du <a href="https://remotes.r-lib.org/index.html">package <code>remotes</code></a>. Les fonctions de configuration de packages, telle que <code>create_package</code> et d’autres fonctions que nous utiliserons plus loin, proviennent quant à elles du <a href="https://usethis.r-lib.org/">package <code>usethis</code></a>. Enfin, les fonctions permettant de lancer des commandes de vérification et de construction de packages proviennent directement du package <code>devtools</code>.</p>
<p>Pour la suite, le package <code>devtools</code> doit être installé sur notre ordinateur (ce qui implique que le package <code>usethis</code> y sera aussi installé). Nous ne le chargerons cependant pas. Nous allons plutôt appeler les fonctions distribuées par ce package en les précédant de l’opérateur <code>::</code> et du nom de leur package exact de provenance, par exemple <code>usethis::create_package()</code>.</p>
</div>
<div id="répertoire-principal-portant-le-nom-du-package" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Répertoire principal portant le nom du package</h2>
<p>Premièrement, un nom doit être choisi pour le package. Ce nom peut contenir uniquement les caractères ASCII suivants : lettres, chiffres et <code>.</code> (point). Il ne peut donc pas contenir de lettres accentuées, ni le caractère <code>_</code> (tiret bas ou <em>underscore</em> en anglais). Il doit être composé d’au moins 2 caractères, débuter par une lettre et ne pas terminer par un point. Ces règles sont tirées de la description du champ <code>Package</code> dans le fichier <code>DESCRIPTION</code> dans la documentation suivante : <a href="https://cran.r-project.org/doc/manuals/r-release/R-exts.html#The-DESCRIPTION-file" class="uri">https://cran.r-project.org/doc/manuals/r-release/R-exts.html#The-DESCRIPTION-file</a></p>
<p>Notons que si nous souhaitons ultimement rendre notre package public sur le CRAN ou Bioconductor, il faut aussi s’assurer que le nom que nous avons choisi n’est pas déjà utilisé par un package sur cette plateforme. Le <a href="https://CRAN.R-project.org/package=available">package R <code>available</code></a> permet de facilement vérifier la disponibilité d’un nom potentiel pour notre package.</p>
<p>Ensuite, utilisons la fonction <code>usethis::create_package</code> pour créer ce répertoire et sa structure de base. Le premier argument à fournir obligatoirement à la fonction <code>usethis::create_package</code> est l’emplacement désiré pour le répertoire sur notre ordinateur. Nous allons aussi demander à la fonction de créer un projet RStudio à partir du répertoire principal du package en donnant la valeur <code>TRUE</code> à l’argument <code>rstudio</code>. Appeler la fonction <code>usethis::create_package</code> à partir de RStudio a aussi cet impact. Le projet RStudio nous sera utile plus tard, lors de la construction du package. Finalement, nous utiliserons l’argument <code>open = TRUE</code> pour ouvrir le projet RStudio dans une nouvelle session R.</p>
<div id="exemple-1" class="section level4 unnumbered">
<h4>Exemple :</h4>
<p></p>
<p>Dans notre exemple, choisissons le nom <code>manhattan</code> pour le package. Le répertoire principal du package sera un sous-répertoire de <code>"C:/coursR/"</code>. Le chemin complet du répertoire principal du package, à fournir à la fonction <code>create_package</code>, est donc <code>"C:/coursR/manhattan/"</code>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">create_package</span>(<span class="at">path =</span> <span class="st">&quot;C:/coursR/manhattan/&quot;</span>, <span class="at">rstudio =</span> <span class="cn">TRUE</span>, <span class="at">open =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## √ Creating &#39;C:/coursR/manhattan/&#39;
## √ Setting active project to &#39;C:/coursR/manhattan&#39;
## √ Creating &#39;R/&#39;
## √ Writing &#39;DESCRIPTION&#39;
## Package: manhattan
## Title: What the Package Does (One Line, Title Case)
## Version: 0.0.0.9000
## Authors@R (parsed):
##     * First Last &lt;first.last@example.com&gt; [aut, cre] (YOUR-ORCID-ID)
## Description: What the package does (one paragraph).
## License: `use_mit_license()`, `use_gpl3_license()` or friends to
##     pick a license
## ## Encoding: UTF-8
## LazyData: true
## Roxygen: list(markdown = TRUE)
## RoxygenNote: 7.1.1
## √ Writing &#39;NAMESPACE&#39;
## √ Writing &#39;manhattan.Rproj&#39;
## √ Adding &#39;^manhattan\\.Rproj$&#39; to &#39;.Rbuildignore&#39;
## √ Adding &#39;.Rproj.user&#39; to &#39;.gitignore&#39;
## √ Adding &#39;^\\.Rproj\\.user$&#39; to &#39;.Rbuildignore&#39;
## √ Opening &#39;C:/coursR/manhattan/&#39; in new RStudio session
## √ Setting active project to &#39;&lt;no active project&gt;&#39;</code></pre>
<p>Le travail réalisé par cette commande est bien décrit par l’impression produite. L’arborescence de répertoires et fichiers suivante a été produite :</p>
<pre><code>manhattan/
  |-- R/
  |-- DESCRIPTION
  |-- NAMESPACE
  |-- manhattan.Rproj</code></pre>
<p>Le répertoire créé contient aussi des fichiers et répertoires cachés, dont le nom débute par un point (notamment <code>.Rproj.user/</code> et <code>.Rbuildignore</code>). Il s’agit de fichiers dont RStudio a besoin pour la gestion du projet, mais dont nous n’avons pas à nous soucier.</p>
<p>Toutes les manipulations futures décrites ci-dessous doivent être réalisées <strong>dans le projet RStudio de notre package en développement</strong>, qui vient d’être ouvert par l’appel à la fonction <code>usethis::create_package</code>.</p>
</div>
</div>
<div id="sous-répertoire-r" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Sous-répertoire <code>R/</code></h2>
<p>Le sous-répertoire <code>R/</code> est l’endroit où placer les fichiers de scripts R (portant l’extension <code>.R</code>) contenant le code de création des fonctions. Ces fichiers doivent aussi contenir des commentaires <code>roxygen</code> si c’est l’outil utilisé pour générer la documentation, ce qui est le cas pour nous (nous y reviendrons plus loin).</p>
<p>Le développeur peut choisir les noms qu’il veut pour ces fichiers et il peut y répartir le code source comme il le veut. Évidemment, une bonne pratique est de répartir le code source de façon à ce que ce soit facile de s’y retrouver. Certains préconisent la stratégie « un fichier par fonction, portant le nom de la fonction », mais ce n’est pas obligatoire. La stratégie opposée, « un seul fichier contenant toutes les fonctions », représente rarement une bonne répartition du code, à moins que les fonctions soient très peu nombreuses.</p>
<p>Nous pouvons utiliser la <a href="https://usethis.r-lib.org/reference/use_r.html">fonction <code>use_r</code></a> du package <code>usethis</code> pour créer dans le sous-répertoire <code>R</code> des fichiers où nous enregistrerons le code source des fonctions. Cette fonction ouvre également le fichier.</p>
<div id="exemple-2" class="section level4 unnumbered">
<h4>Exemple :</h4>
<p></p>
<p>Nous allons placer chacune des trois fonctions à mettre dans notre package dans trois fichiers séparés. Après cette étape, l’arborescence du package aura l’allure suivante :</p>
<pre><code>manhattan/
  |-- R/
      |-- dist_manhattan.R
      |-- dist_manhattan_2.R
      |-- print.R
  |-- DESCRIPTION
  |-- NAMESPACE
  |-- manhattan.Rproj</code></pre>
<div id="fichier-dist_manhattan.r" class="section level5 unnumbered">
<h5>Fichier <code>dist_manhattan.R</code></h5>
<p></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_r</span>(<span class="at">name =</span> <span class="st">&quot;dist_manhattan&quot;</span>)</span></code></pre></div>
<pre><code>## √ Setting active project to &#39;C:/coursR/manhattan&#39;
## * Modify &#39;R/dist_manhattan.R&#39;
## * Call `use_test()` to create a matching test file</code></pre>
<p>Le fichier <code>dist_manhattan.R</code> a été créé dans le sous-répertoire <code>R</code>. L’extension <code>.R</code> lui a été donnée par la fonction <code>usethis::use_r</code>. Il faut maintenant copier le code R suivant dans ce fichier et enregistrer le fichier.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>dist_manhattan <span class="ot">&lt;-</span> <span class="cf">function</span>(point1, point2) {</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(point1) <span class="sc">!=</span> <span class="fu">length</span>(point2)) {</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;&#39;point1&#39; and &#39;point2&#39; must have the same length&quot;</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">dim</span>(point1)) <span class="sc">||</span> <span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">dim</span>(point2))) {</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="st">&quot;&#39;point1&#39; and &#39;point2&#39; are treated as dimension 1 vectors&quot;</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  sortie <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">dist =</span> <span class="fu">sum</span>(<span class="fu">abs</span>(point1 <span class="sc">-</span> point2)))</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(sortie) <span class="ot">&lt;-</span> <span class="st">&quot;distman&quot;</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(sortie)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="fichier-dist_manhattan_2.r" class="section level5 unnumbered">
<h5>Fichier <code>dist_manhattan_2.R</code></h5>
<p></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_r</span>(<span class="at">name =</span> <span class="st">&quot;dist_manhattan_2&quot;</span>)</span></code></pre></div>
<pre><code>## * Modify &#39;R/dist_manhattan_2.R&#39;
## * Call `use_test()` to create a matching test file</code></pre>
<p>Copions le code R suivant dans le fichier ouvert et enregistrons le fichier.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>dist_manhattan_2 <span class="ot">&lt;-</span> <span class="cf">function</span>(point1, point2) {</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  call <span class="ot">&lt;-</span> <span class="fu">match.call</span>()</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  dist <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">dist</span>(<span class="fu">rbind</span>(point1, point2), <span class="at">method =</span> <span class="st">&quot;manhattan&quot;</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  sortie <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">dist =</span> <span class="fu">as.vector</span>(dist), <span class="at">call =</span> call)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(sortie) <span class="ot">&lt;-</span> <span class="st">&quot;distman&quot;</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(sortie)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="fichier-print.r" class="section level5 unnumbered">
<h5>Fichier <code>print.R</code></h5>
<p></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_r</span>(<span class="at">name =</span> <span class="st">&quot;print.distman&quot;</span>)</span></code></pre></div>
<pre><code>## * Modify &#39;R/print.R&#39;
## * Call `use_test()` to create a matching test file</code></pre>
<p>Copions le code R suivant dans le fichier <code>R/print.R</code> et enregistrons le fichier.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>print.distman <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ...) {</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Manhattan distance between &#39;point1&#39; and &#39;point2&#39; :&quot;</span>, x<span class="sc">$</span>dist, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>, ...)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invisible</span>(x)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
</div>
<div id="sous-répertoire-data" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Sous-répertoire <code>data/</code></h2>
<p>Bien qu’il ne soit pas obligatoire, décrivons ici le sous-répertoire <code>data/</code>. Si le package doit contenir des données accessibles aux utilisateurs, c’est ici quelles doivent être placées. Elles doivent être stockées dans des objets R enregistrés dans des fichiers externes (un fichier par objet) sous un format propre à R (souvent <code>.rda</code> ou <code>.RData</code>). Ces données sont utiles, notamment, pour avoir des données à utiliser dans les exemples inclus dans les fiches d’aide.</p>
<p>La <a href="https://usethis.r-lib.org/reference/use_data.html">fonction <code>use_data</code></a> du package <code>usethis</code> facilite l’intégration de données à un package R. Illustrons comment l’utiliser dans l’exemple du package <code>manhattan</code>.</p>
<p>Notons qu’un package peut aussi contenir des données privées ou brutes (p. ex. un fichier texte comprenant des données). Nous ne verrons pas ici comment procéder pour intégrer ce type de données, mais voici une bonne source d’informations à ce sujet pour les intéressés : <a href="https://r-pkgs.org/data.html" class="uri">https://r-pkgs.org/data.html</a>.</p>
<div id="exemple-3" class="section level4 unnumbered">
<h4>Exemple :</h4>
<p></p>
<p>Créons un petit jeu de données aléatoire contenant 10 points en 2 dimensions.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>points <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">size =</span> <span class="dv">20</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>), <span class="at">nrow =</span> <span class="dv">10</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(points) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;Y&quot;</span>)</span></code></pre></div>
<p>Ajoutons cette matrice au package avec la commande suivante.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_data</span>(points)</span></code></pre></div>
<pre><code>## √ Adding &#39;R&#39; to Depends field in DESCRIPTION
## √ Creating &#39;data/&#39;
## √ Saving &#39;points&#39; to &#39;data/points.rda&#39;
## * Document your data (see &#39;https://r-pkgs.org/data.html&#39;)</code></pre>
<p>L’arborescence de répertoires et fichiers du package est maintenant la suivante (toujours sans les répertoires et fichiers cachés) :</p>
<pre><code>manhattan/
  |-- R/
      |-- dist_manhattan.R
      |-- dist_manhattan_2.R
      |-- print.R
  |-- data/
      |-- points.rda
  |-- DESCRIPTION
  |-- NAMESPACE
  |-- manhattan.Rproj</code></pre>
</div>
</div>
<div id="sous-répertoire-man" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Sous-répertoire <code>man/</code></h2>
<p>Malgré le fait que celui-ci soit obligatoire, aucun sous-répertoire <code>man/</code> n’a été inclus dans le répertoire principal du package par la fonction <code>usethis::create_package</code>. Ce sous-répertoire est celui destiné à contenir des fichiers source de fiches d’aide R (portant l’extension <code>.Rd</code>). Nous allons voir à la prochaine étape comment générer ces fichiers de façon automatique à l’aide du package <code>roxygen2</code>.</p>
</div>
<div id="fichier-description" class="section level2" number="2.5">
<h2><span class="header-section-number">2.5</span> Fichier <code>DESCRIPTION</code></h2>
<p>Le <a href="https://cran.r-project.org/doc/manuals/r-release/R-exts.html#The-DESCRIPTION-file">fichier <code>DESCRIPTION</code></a> est très important pour la construction du package. C’est un fichier court, comportant de l’information de base décrivant l’utilité du package ainsi que ses configurations. Ce fichier doit respecter une syntaxe précise.</p>
<p>Par exemple, voici le gabarit de fichier <code>DESCRIPTION</code> qu’a produit l’appel à la fonction <code>usethis::create_package</code> (et qu’a modifié l’appel à la fonction <code>usethis::use_data</code>). Ce fichier doit être édité pour y insérer les bonnes informations.</p>
<pre><code>Package: manhattan
Title: What the Package Does (One Line, Title Case)
Version: 0.0.0.9000
Authors@R: 
    person(given = &quot;First&quot;,
           family = &quot;Last&quot;,
           role = c(&quot;aut&quot;, &quot;cre&quot;),
           email = &quot;first.last@example.com&quot;,
           comment = c(ORCID = &quot;YOUR-ORCID-ID&quot;))
Description: What the package does (one paragraph).
License: `use_mit_license()`, `use_gpl3_license()` or friends to
    pick a license
Encoding: UTF-8
LazyData: true
Roxygen: list(markdown = TRUE)
RoxygenNote: 7.1.1
Depends: 
    R (&gt;= 2.10)</code></pre>
<p> </p>
<p>Un fichier <code>DESCRIPTION</code> contient des champs nommés. Un champ débute par son nom (première lettre toujours majuscule), immédiatement suivi d’un deux-points et d’un espace. Vient ensuite la valeur fournie à ce champ. Les valeurs données aux champs peuvent s’étendre sur plus d’une ligne. De plus, l’ordre des champs n’est pas important.</p>
<p>Les champs obligatoires sont les suivants : <code>Package</code>, <code>Version</code>, <code>License</code>, <code>Title</code>, <code>Description</code>, <code>Author</code>, et <code>Maintainer</code>. Les champs <code>Author</code>, et <code>Maintainer</code> peuvent être remplacés par un seul champ <code>Authors@R</code>, comme dans le gabarit. Les codes de rôles acceptés dans ces champs sont énumérés dans la fiche d’aide ouverte par la commande <a href="https://stat.ethz.ch/R-manual/R-patched/library/utils/html/person.html"><code>help(person)</code></a>.</p>
<p>Voici quelques informations spécifiques à certains champs :</p>
<ul>
<li><code>Package</code> : le nom du package fourni dans ce champ doit correspondre parfaitement au nom du répertoire contenant les fichiers source du package;</li>
<li><code>Version</code> : il s’agit d’une séquence d’au minimum 2 (souvent 3, parfois même 4) nombres entiers non négatifs séparés par un seul caractère <code>.</code> (point) ou <code>-</code> (tiret);</li>
<li><code>Maintainer</code> : ce champ doit contenir un seul nom, celui de la personne à contacter pour toute question ou tout problème à rapporter concernant le package, suivi d’une adresse courriel valide placée entre les caractères <code>&lt;</code> et <code>&gt;</code>;</li>
<li><code>Depends</code> : ce champ est requis si le bon fonctionnement du package nécessite une certaine version minimale de R ou si d’autres packages doivent être chargés lors du chargement de notre package;</li>
<li><code>Imports</code> : ce champ contient la liste des autres packages à partir desquels des objets sont importés par le package (les packages d’où proviennent ceux-ci doivent être installés, mais ils n’ont pas besoin d’être chargés lors du chargement de notre package);</li>
<li><code>LazyData</code>: si la valeur <code>true</code> est fournie dans ce champ, les jeux de données contenus dans le package seront directement accessibles dans l’environnement du package, sans que l’utilisateur ait besoin d’appeler la fonction <code>data</code> (nous avions discuté des différentes façons d’accéder à des jeux de données dans un package dans les <a href="https://stt4230.rbind.io/packages/utilisation_packages_r/#jeux-de-donn%C3%A9es">notes sur l’utilisation de packages R</a>).</li>
</ul>
<p>Le fichier <code>DESCRIPTION</code> doit contenir uniquement des caractères ASCII, sauf s’il contient un champ <code>Encoding</code>.</p>
<p>L’information complète et officielle concernant ce fichier peut être trouvée sur la page web suivante :<br />
<a href="http://cran.r-project.org/doc/manuals/r-release/R-exts.html#The-DESCRIPTION-file" class="uri">http://cran.r-project.org/doc/manuals/r-release/R-exts.html#The-DESCRIPTION-file</a></p>
<p>Le gabarit de fichier <code>DESCRIPTION</code> produit par la fonction <code>usethis::create_package</code> peut être modifié manuellement, en ouvrant le fichier (dans un éditeur de texte en RStudio par exemple), en remplaçant les informations génériques par les bonnes, puis en enregistrant le fichier. C’est la méthode que nous emploierons. Le package <code>usethis</code> possède aussi des fonctions permettant d’éditer le fichier <code>DESCRIPTION</code> par des commandes soumises dans la console, notamment :</p>
<ul>
<li>la fonction <code>use_description</code> (pour modifier n’importe quel champ),</li>
<li>la fonction <code>use_package</code> (pour modifier le champ <code>Imports</code> ou un autre champ relié aux dépendances à d’autres packages) et</li>
<li>des fonctions pour spécifier la licence utilisée (p. ex. <code>use_mit_license</code>, <code>use_gpl3_license</code>, etc.) : ces fonctions ajoutent même un fichier <code>LICENSE</code> au répertoire principal du package.</li>
</ul>
<p>Nous n’illustrerons pas ici l’utilisation de ces fonctions.</p>
<div id="exemple-4" class="section level4 unnumbered">
<h4>Exemple :</h4>
<p></p>
<p>Voici le contenu du fichier <code>DESCRIPTION</code> à utiliser pour notre package en développement.</p>
<pre><code>Package: manhattan
Title: Distance de Manhattan
Version: 1.0.0
Author: Sophie Baillargeon [aut, cre], Autre Auteur [aut]
Maintainer: Sophie Baillargeon &lt;sophie.baillargeon@mat.ulaval.ca&gt;
Description: Calcul de la distance de Manhattan entre deux points.
License: GPL-3
Encoding: UTF-8
LazyData: true
RoxygenNote: 7.1.1
Depends: R (&gt;= 2.10)
Imports: stats</code></pre>
<p> </p>
<p>Le champ <code>Depends</code> est nécessaire uniquement en raison d’un détail technique. Nous avons inclus un jeu de données dans le package avec la fonction <code>usethis::use_data</code>. Celle-ci a en fait utilisé la fonction <code>save</code> pour créer le fichier <code>.rda</code> contenant les données. Cependant, le format de fichier créé par cette fonction a légèrement changé au fil des ans. La fonction <code>usethis::use_data</code> a par défaut utilisé un format qui peut seulement être compris par une version de R égale ou plus récente que 2.10. Il s’agit d’une très vieille version de R. Ce n’est donc pas vraiment une contrainte de dépendre de l’utilisation d’une version de R &gt;= 2.10.</p>
<p>Le champ <code>Imports</code>, contenant ici le package <code>stats</code>, est requis puisque la fonction <code>dist_manhattan</code> utilise une fonction de ce package.</p>
<p>Notons que le champ <code>Authors@R</code> suivant pourrait remplacer les champs <code>Author</code> et <code>Maintainer</code> précédents.</p>
<pre><code>Authors@R: c(
    person(given = &quot;Sophie&quot;, family = &quot;Baillargeon&quot;, role = c(&quot;aut&quot;, &quot;cre&quot;),
           email = &quot;sophie.baillargeon@mat.ulaval.ca&quot;),
    person(given = &quot;Autre&quot;, family = &quot;Auteur&quot;, role = &quot;aut&quot;))</code></pre>
</div>
</div>
<div id="fichier-namespace" class="section level2" number="2.6">
<h2><span class="header-section-number">2.6</span> Fichier <code>NAMESPACE</code></h2>
<p>Le fichier <code>NAMESPACE</code> permet de définir quels objets sont accessibles dans un package, c’est-à-dire exportés de l’espace de noms du package. Ce fichier permet aussi d’identifier quels objets provenant d’autres packages sont utilisés dans le package, donc de définir le contenu de l’environnement des objets importés par le package. Nous allons voir comment utiliser <code>roxygen2</code> pour générer de façon automatique ce fichier.</p>
</div>
<div id="autres-fichiers-et-répertoires" class="section level2" number="2.7">
<h2><span class="header-section-number">2.7</span> Autres fichiers et répertoires</h2>
<p>Un package peut contenir plusieurs autres fichiers et sous-répertoires, comme nous avons pu le constater avec le package <code>ggplot2</code>. Voici quelques autres répertoires parfois nécessaires :</p>
<ul>
<li>Sous-répertoire nommé <code>src</code> : Si le package contient du code C, C++ ou Fortran, ce code doit se trouver dans ce répertoire.</li>
<li>Sous-répertoire nommé <code>vignettes</code> : Si le package contient de la documentation autre que les fiches d’aide (par exemple un guide d’utilisateur), il devrait idéalement se trouver dans ce répertoire.</li>
<li>Sous-répertoire nommé <code>tests</code> : Des tests, par exemple écrits avec <code>testthat</code>, peuvent être intégrés au package dans ce sous-répertoire et exécutés à chaque fois que le package est vérifié (<code>check</code> décrit à l’étape 4). Pour en savoir plus : <a href="https://r-pkgs.org/tests.html#test-structure" class="uri">https://r-pkgs.org/tests.html#test-structure</a></li>
<li>etc. : <a href="http://cran.r-project.org/doc/manuals/r-release/R-exts.html#Package-subdirectories" class="uri">http://cran.r-project.org/doc/manuals/r-release/R-exts.html#Package-subdirectories</a></li>
</ul>
<p>Autres fichiers utiles :</p>
<ul>
<li>Fichier nommé <code>NEWS</code> ou <code>NEWS.md</code> : Ce fichier décrit les modifications apportées à un package lors d’une mise à jour. Plusieurs types de mise en forme sont acceptés pour ce fichier.</li>
<li>etc. : <a href="http://cran.r-project.org/doc/manuals/r-release/R-exts.html#Package-structure" class="uri">http://cran.r-project.org/doc/manuals/r-release/R-exts.html#Package-structure</a></li>
</ul>
</div>
</div>
<div id="étape-3.-écrire-la-documentation-des-fonctions-et-du-package" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Étape 3. Écrire la documentation des fonctions et du package</h1>
<p>Documenter ses fonctions est une étape intégrée au développement des fonctions. Cependant, il faut maintenant écrire la documentation dans un format qui produira correctement les fiches d’aide qui doivent être incluses dans le package.</p>
<p>Ces fiches d’aide proviennent en fait de fichiers portant l’extension <code>.Rd</code>. Cependant, nous ne verrons pas comment éditer directement ces fichiers. Nous allons plutôt apprendre à utiliser le <a href="https://roxygen2.r-lib.org/">package <code>roxygen2</code></a>, qui permet de générer des fichiers <code>.Rd</code>, ainsi que le fichier <code>NAMESAPCE</code>, de façon automatique, à partir de commentaires intégrés au code.</p>
<p>L’utilisation de <code>roxygen2</code> comporte les avantages suivants :</p>
<ul>
<li>la documentation se situe dans le même fichier que le code, ce qui aide à se rappeler que la documentation doit être mise à jour si le code est modifié,</li>
<li>la syntaxe <code>roxygen2</code> est un peu plus simple que la syntaxe des fichiers <code>.Rd</code> (qui sera illustrée plus loin).</li>
</ul>
<p>Rappelons que dans un package il faut obligatoirement documenter :</p>
<div id="les-fonctions-publiques" class="section level5 unnumbered">
<h5>Les fonctions publiques</h5>
<p></p>
<p>Il est essentiel de faire des fiches d’aide pour ces fonctions, afin que tout utilisateur comprenne comment appeler correctement la fonction. Si un utilisateur a mal compris la documentation et fournit par erreur une valeur d’argument invalide en entrée, il est aussi souhaitable que la fonction retourne une erreur informative. Le code de ces fonctions publiques comporte donc typiquement de la validation des valeurs fournies en entrée aux arguments.</p>
<p>À l’opposé, les fonctions privées ou internes ne sont pas conçues pour être appelées par n’importe quel utilisateur. Ces fonctions ne sont pas exportées de l’espace de noms et elles ne sont pas documentées officiellement. Il est tout de même bon de documenter minimalement ces fonctions pour nous-mêmes, mais nous n’avons pas à produire de fiches d’aide pour elles. De plus, pour ne pas alourdir ces fonctions, elles comportent typiquement peu ou pas de validation d’arguments.</p>
</div>
<div id="les-jeux-de-données-dans-le-répertoire-data" class="section level5 unnumbered">
<h5>Les jeux de données dans le répertoire <code>data/</code></h5>
<p></p>
<p>Chaque jeu de données dans le répertoire <code>data</code> d’un package doit être décrit dans une fiche d’aide pour expliquer son contenu.</p>
</div>
<div id="les-classes-et-méthodes-s4-ou-rc-publiques" class="section level5 unnumbered">
<h5>Les classes et méthodes S4 ou RC publiques</h5>
<p></p>
<p>Les packages exploitant le système de programmation orientée objet S4 ou le système RC doivent fournir des fiches d’aide pour les classes et méthodes publiques. Nous ne verrons pas ici comment écrire cette documentation, car nous utiliserons seulement le système orienté objet S3. Plus d’information peut être trouvée sur les pages web suivantes :</p>
<ul>
<li><a href="https://cran.r-project.org/doc/manuals/r-release/R-exts.html#Documenting-S4-classes-and-methods" class="uri">https://cran.r-project.org/doc/manuals/r-release/R-exts.html#Documenting-S4-classes-and-methods</a></li>
<li><a href="https://r-pkgs.org/man.html#man-classes" class="uri">https://r-pkgs.org/man.html#man-classes</a></li>
</ul>
</div>
<div id="il-est-aussi-recommandé-de-documenter" class="section level5 unnumbered">
<h5>Il est aussi recommandé de documenter :</h5>
<p></p>
<ul>
<li><p>Les méthodes S3 pour des fonctions génériques :<br />
Nous pouvons leur faire une fiche d’aide indépendante ou encore les documenter dans la même fiche d’aide que la fonction qui crée les objets de la classe en question.</p></li>
<li><p>Le package lui-même :<br />
Il est utile de créer une fiche d’aide présentant le package.</p></li>
</ul>
</div>
<div id="documentation-avec-roxygen2" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Documentation avec <code>roxygen2</code></h2>
<p>Comment écrire de la documentation avec <code>roxygen2</code> ? Il suffit d’insérer des « commentaires » <code>roxygen</code> dans le code source des fonctions, donc dans les scripts situés dans le sous-répertoire <code>R</code>. Un commentaire <code>roxygen</code> débute par <code>#'</code>, ce qui le distingue d’un commentaire ordinaire, qui débute par <code>#</code>. Il contient des tags ayant des significations particulières.</p>
<p>RStudio possède une fonctionnalité permettant d’ajouter un gabarit de commentaires <code>roxygen</code> en entête de nos fonctions. Cette fonctionnalité est accessible par le menu « Code &gt; Insert Roxygen Skeleton ».</p>
<div id="exemple-5" class="section level4 unnumbered">
<h4>Exemple :</h4>
<p></p>
<p>D’abord, voici ce que nous obtenons si nous demandons à RStudio d’insérer un gabarit de commentaires <code>roxygen</code> en entête de la fonction <code>dist_manhattan</code>.</p>
<p> </p>
<p>Fichier <code>C:/coursR/manhattan/R/dist_manhattan.R</code> :</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Title</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param point1 </span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param point2 </span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @examples</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>dist_manhattan <span class="ot">&lt;-</span> <span class="cf">function</span>(point1, point2) {</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(point1) <span class="sc">!=</span> <span class="fu">length</span>(point2)) {</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;&#39;point1&#39; and &#39;point2&#39; must have the same length&quot;</span>)</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">dim</span>(point1)) <span class="sc">||</span> <span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">dim</span>(point2))) {</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="st">&quot;&#39;point1&#39; and &#39;point2&#39; are treated as dimension 1 vectors&quot;</span>)</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>  sortie <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">dist =</span> <span class="fu">sum</span>(<span class="fu">abs</span>(point1 <span class="sc">-</span> point2)))</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(sortie) <span class="ot">&lt;-</span> <span class="st">&quot;distman&quot;</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(sortie)</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p> </p>
<p>Après adaptation, voici de quoi ce fichier pourrait avoir l’air.</p>
<p> </p>
<p>Fichier <code>C:/coursR/manhattan/R/dist_manhattan.R</code> :</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Distance de Manhattan</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Calcule la distance de Manhattan entre deux points</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param point1 Un vecteur numerique des coordonnees du premier point.</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param point2 Un vecteur numerique des coordonnees du deuxieme point.</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return une seule valeur : la distance de Manhattan entre </span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;                            \code{point1} et \code{point2}</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Sophie Baillargeon</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @examples</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; dist_manhattan(point1 = points[4, ], point2 = points[8, ])</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>dist_manhattan <span class="ot">&lt;-</span> <span class="cf">function</span>(point1, point2) {</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(point1) <span class="sc">!=</span> <span class="fu">length</span>(point2)) </span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;&#39;point1&#39; and &#39;point2&#39; must have the same length&quot;</span>)</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">dim</span>(point1)) <span class="sc">||</span> <span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">dim</span>(point2)))</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="st">&quot;&#39;point1&#39; and &#39;point2&#39; are treated as dimension 1 vectors&quot;</span>)</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>  sortie <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">dist =</span> <span class="fu">sum</span>(<span class="fu">abs</span>(point1 <span class="sc">-</span> point2)))</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(sortie) <span class="ot">&lt;-</span> <span class="st">&quot;distman&quot;</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(sortie)</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p> </p>
<p>Des explications concernant les différents tags se retrouvent après les exemples. Avant voyons aussi les commentaires <code>roxygen</code> que nous pourrions utiliser pour les fonctions <code>dist_manhattan_2</code> et <code>print.distman</code>.</p>
<p> </p>
<p>Fichier <code>C:/coursR/manhattan/R/dist_manhattan_2.R</code> :</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Distance de Manhattan</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Calcule la distance de Manhattan entre deux points</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Utilise la fonction \code{\link[stats]{dist}} du package \pkg{stats}.</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param point1 Un vecteur numerique des coordonnees du premier point.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param point2 Un vecteur numerique des coordonnees du deuxieme point.</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return \item{dist}{ la distance de Manhattan entre \code{point1} et \code{point2} }</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return \item{call}{ une copie de l&#39;appel de la fonction }</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Sophie Baillargeon</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @importFrom stats dist</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @examples</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; dist_manhattan_2(point1 = c(0,-5, 3), point2 = c(2,-15, 4)) </span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>dist_manhattan_2 <span class="ot">&lt;-</span> <span class="cf">function</span>(point1, point2) {</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>  call <span class="ot">&lt;-</span> <span class="fu">match.call</span>()</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>  dist <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">dist</span>(<span class="fu">rbind</span>(point1, point2), <span class="at">method =</span> <span class="st">&quot;manhattan&quot;</span>)</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>  sortie <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">dist =</span> <span class="fu">as.vector</span>(dist), <span class="at">call =</span> call)</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(sortie) <span class="ot">&lt;-</span> <span class="st">&quot;distman&quot;</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(sortie)</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p> </p>
<p>Fichier <code>C:/coursR/manhattan/R/print.R</code> :</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @describeIn dist_manhattan Affiche un objet de classe \code{&quot;distman&quot;}</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param x Un objet produit par la fonction \code{dist_manhattan} ou </span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;          \code{dist_manhattan_2}, a afficher.</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param \dots D&#39;autres arguments passes a d&#39;autres methodes. </span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>print.distman <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ...) {</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Manhattan distance between &#39;point1&#39; and &#39;point2&#39; :&quot;</span>, x<span class="sc">$</span>dist, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>, ...)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invisible</span>(x)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p> </p>
<p>Finalement, pour produire une fiche d’aide minimalise pour le package lui-même, nous pourrions utiliser la <a href="https://usethis.r-lib.org/reference/use_package_doc.html">fonction <code>use_package_doc</code></a> du package <code>usethis</code>.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_package_doc</span>()</span></code></pre></div>
<pre><code>## √ Writing &#39;R/manhattan-package.R&#39;
## * Modify &#39;R/manhattan-package.R&#39;</code></pre>
<p>Cette commande à créer le fichier <code>manhattan-package.R</code> dans le répertoire <code>R</code>. Voici un aperçu de son contenu initial.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @keywords internal</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;_PACKAGE&quot;</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co"># The following block is used by usethis to automatically manage</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co"># roxygen namespace tags. Modify with care!</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="do">## usethis namespace: start</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="do">## usethis namespace: end</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="cn">NULL</span></span></code></pre></div>
<p>Nous ne retoucherons pas ici à ces commentaires. La fiche d’aide du package contiendra uniquement une copie des champs <code>Title</code> et <code>Description</code> du fichier <code>DESCRIPTION</code>. Nous pourrions évidemment y ajouter plus d’informations.</p>
<p>Il faut ajouter quelque part un dernier bloc de commentaires <code>roxygen</code> pour documenter le jeu de données inclus dans le package. Cet ajout pourrait être fait dans n’importe quel fichier du répertoire <code>R</code>. Nous ferons l’ajout dans le fichier <code>manhattan-package.R</code>.</p>
<p> </p>
<p>Fichier <code>C:/coursR/manhattan/R/manhattan-package.R</code> après l’ajout :</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @keywords internal</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;_PACKAGE&quot;</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># The following block is used by usethis to automatically manage</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co"># roxygen namespace tags. Modify with care!</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="do">## usethis namespace: start</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="do">## usethis namespace: end</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="cn">NULL</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Points aleatoires</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Coordonnes en deux dimensions de 10 points aleatoires.</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @format Une matrice contenant 10 points designes par les</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;         coordonnees suivantes.</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \describe{</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;   \item{\code{X}}{ coordonnee en X }</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;   \item{\code{Y}}{ coordonnee en Y }</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; }</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @examples</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; dist_manhattan(point1 = points[4, ], point2 = points[8, ])</span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; # Note : Ces donnees ont ete crees par les instructions suivantes</span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; points &lt;- matrix(sample(1:10, size = 20, replace = TRUE),</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;                  nrow = 10, ncol = 2)</span></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; colnames(points) &lt;- c(&quot;X&quot;, &quot;Y&quot;)</span></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;points&quot;</span></span></code></pre></div>
<p> </p>
</div>
<div id="explications" class="section level4 unnumbered">
<h4>Explications :</h4>
<p></p>
<p>Pour les fonctions et les méthodes associées à des fonctions génériques, il suffit de mettre en entête du code source les commentaires <code>roxygen</code> qui généreront la documentation. Pour le package et les jeux de données, il est recommandé d’ajouter un ou des fichiers d’extension <code>.R</code> dans le répertoire <code>R</code>. Ces fichiers doivent contenir les commentaires <code>roxygen</code> pour documenter globalement le package, suivi de l’instruction <code>"_PACKAGE"</code>, et les commentaires pour documenter les jeux de données, chaque bloc suivi du nom du jeu de données sous forme de chaîne de caractères (par exemple <code>"points"</code>) .</p>
<p>La première phrase d’un bloc de commentaires <code>roxygen</code>, si elle n’est précédée d’aucun tag <code>roxygen</code>, sera interprétée comme le <strong>titre</strong> de la fiche d’aide. Ce titre peut aussi être précédé du tag <code>@title</code>.</p>
<p>Si le titre est suivi d’une ligne de commentaire <code>roxygen</code> vide, puis de lignes de texte non précédées d’un tag, celles-ci constitueront la section <strong>Description</strong>. Ce paragraphe peut aussi être précédé du tag <code>@description</code>.</p>
<p>Si le paragraphe est aussi suivi d’une ligne de commentaire <code>roxygen</code> vide, tout le texte après cette ligne vide, mais avant les lignes débutant par un tag <code>roxygen</code> formera la section <strong>Details</strong>. Ces paragraphes peuvent optionnellement être précédés du tag <code>@details</code>.</p>
<p>Ainsi, les deux documentations suivantes sont équivalentes :</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Distance de Manhattan</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Calcule la distance de Manhattan entre deux points</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Utilise la fonction \code{\link[stats]{dist}} du package \pkg{stats}.</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param point1 Un vecteur numerique des coordonnees du premier point.</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param point2 Un vecteur numerique des coordonnees du deuxieme point.</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return \item{dist}{ la distance de Manhattan entre \code{point1} et \code{point2} }</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return \item{call}{ une copie de l&#39;appel de la fonction }</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Sophie Baillargeon</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @importFrom stats dist</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @examples</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; dist_manhattan_2(point1 = c(0,-5, 3), point2 = c(2,-15, 4))  </span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>dist_manhattan_2 <span class="ot">&lt;-</span> <span class="cf">function</span>(point1, point2) {</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ... (code omis ici)</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>et</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @title Distance de Manhattan</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @description Calcule la distance de Manhattan entre deux points</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @details Utilise la fonction \code{\link[stats]{dist}} du package \pkg{stats}.</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param point1 Un vecteur numerique des coordonnees du premier point.</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param point2 Un vecteur numerique des coordonnees du deuxieme point.</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return \item{dist}{ la distance de Manhattan entre \code{point1} et \code{point2} }</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return \item{call}{ une copie de l&#39;appel de la fonction }</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Sophie Baillargeon</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @importFrom stats dist</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @examples</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; dist_manhattan_2(point1 = c(0,-5, 3), point2 = c(2,-15, 4))  </span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>dist_manhattan_2 <span class="ot">&lt;-</span> <span class="cf">function</span>(point1, point2) {</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ... (code omis ici)</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Les sections qui suivent le titre, la description (ces sections sont requises) et les informations détaillées (cette section est optionnelle), doivent toutes débuter par des tags. Il faut obligatoirement décrire, si la fonction en possède :</p>
<ul>
<li>les arguments en entrée avec le tag <code>@param</code> :<br />
il faut une description par argument, de la forme <code>@param &lt;nom_argument&gt; &lt;description&gt;</code>, où la description peut s’étendre sur plusieurs lignes;</li>
<li>la sortie avec le tag <code>@return</code> :<br />
si la fonction retourne une liste, il est recommandé d’avoir une description par élément de la liste, de la forme <code>@return \item{&lt;nom_element_liste&gt;}{&lt;description&gt;}</code>, où la description peut encore une fois s’étendre sur plusieurs lignes.</li>
</ul>
<p>Il est recommandé de toujours mettre un ou des exemples dans la fiche d’aide d’une fonction ou d’un jeu de données. Dans la documentation <code>roxygen</code>, ceux-ci doivent être ajoutés à la fin du bloc de documentation, après le tag <code>@examples</code>.</p>
<p>Nous pouvons aussi ajouter les informations suivantes :</p>
<ul>
<li>les noms des auteurs avec le tag <code>@author</code>,</li>
<li>des références avec le tag <code>@references</code>,</li>
<li>des liens vers les fiches d’aide de fonction en lien avec la fonction documentée avec le tag <code>@seealso</code>,</li>
<li>etc. voir <a href="https://roxygen2.r-lib.org/articles/rd.html" class="uri">https://roxygen2.r-lib.org/articles/rd.html</a></li>
</ul>
<p> </p>
<div id="documenter-plusieurs-fonctions-dans-la-même-fiche" class="section level5 unnumbered">
<h5>Documenter plusieurs fonctions dans la même fiche</h5>
<p></p>
<p>Le tag <code>@describeIn</code> sert à présenter plusieurs fonctions dans la même fiche d’aide. Dans l’exemple, la fonction <code>dist_manhattan</code> et la méthode <code>print.distman</code> sont documentées dans la même fiche d’aide grâce au tag <code>@describeIn</code>. Ce tag doit être suivi du nom de la fiche dans laquelle de l’information doit être ajoutée, puis d’une courte description à propos de la fonction ou méthode documentée.</p>
<p>Le tag <code>@rdname</code> permet également de regrouper des fiches d’aide (voir <a href="https://roxygen2.r-lib.org/articles/rd.html#documenting-multiple-functions-in-the-same-file-1" class="uri">https://roxygen2.r-lib.org/articles/rd.html#documenting-multiple-functions-in-the-same-file-1</a> pour plus d’information).</p>
<p> </p>
</div>
<div id="documenter-des-jeux-de-données" class="section level5 unnumbered">
<h5>Documenter des jeux de données</h5>
<p></p>
<p>Pour documenter des jeux de données, deux tags supplémentaires sont disponibles :</p>
<ul>
<li><code>@format</code> pour décrire la structure R qui contient les données,</li>
<li><code>@source</code> pour fournir une référence concernant la provenance des données.</li>
</ul>
<p> </p>
</div>
<div id="nom-des-fiches-daide" class="section level5 unnumbered">
<h5>Nom des fiches d’aide</h5>
<p></p>
<p>Nous pouvons contrôler le nom des fiches d’aide avec le tag <code>@name</code>. Sans ce tag, la fiche d’aide porte le nom de la fonction ou le nom du jeu de données qui suit le bloc de documentation <code>roxygen</code>. Pour une documentation de package, l’instruction <code>"_PACKAGE"</code> qui suit le bloc de documentation indique à <code>roxygen2</code> d’utiliser le nom du package suivi de <code>-package</code> comme nom de fiche d’aide. Dans l’exemple, le nom de la fiche d’aide du package est donc <code>manhattan-package</code>. Cependant, <code>roxygen2</code> crée aussi un alias pour le nom de la fiche d’aide qui est le nom du package.</p>
<p>Pour ouvrir une fiche d’aide avec la fonction <code>help</code> ou l’opérateur <code>?</code>, il faut lui donner en entrée le nom de la fiche ou un alias du nom de la fiche. Il est donc important de nommer intelligemment nos fiches d’aide. La norme est de donner à une fiche d’aide le nom de l’objet principal qu’elle documente et d’ajouter des alias pour les noms des autres objets documentés dans la fiche (c’est ce que fait <code>roxygen2</code> de façon automatique lorsque les tags <code>@describeIn</code> et <code>@rdname</code> sont utilisés).</p>
<p> </p>
</div>
<div id="texte-formaté-dans-des-fiches-daide" class="section level5 unnumbered">
<h5>Texte formaté dans des fiches d’aide</h5>
<p></p>
<p>Dans les commentaires <code>roxygen</code>, il est possible de formater du texte en utilisant les tags de mises en forme acceptés dans les fichiers <code>.Rd</code>. Cette possibilité été exploitée dans les exemples précédents. Ces tags, par exemple <code>\code{}</code>, <code>\pkg{}</code>, <code>\item{}</code>, <code>\link{}</code>, <code>\dots</code>, etc., sont documentés sur la page web suivante : <a href="https://cran.r-project.org/doc/manuals/r-release/R-exts.html#Marking-text" class="uri">https://cran.r-project.org/doc/manuals/r-release/R-exts.html#Marking-text</a></p>
<p>Depuis la version 6.0.0 de <code>roxygen2</code>, il est également possible d’utiliser la syntaxe Markdown dans des commentaires <code>roxygen</code> pour formater le texte. La fonction <code>usethis::create_package</code> avait d’ailleurs considéré par défaut que nous utiliserions cette option en ajoutant le champ <code>Roxygen: list(markdown = TRUE)</code> dans le fichier <code>DESCRIPTION</code>. Nous avons cependant retiré ce champ. Plus d’information à propos de l’utilisation de la syntaxe Markdown dans des commentaires <code>roxygen</code> peut être trouvée ici : <a href="https://roxygen2.r-lib.org/articles/rd-formatting.html" class="uri">https://roxygen2.r-lib.org/articles/rd-formatting.html</a></p>
<p> </p>
</div>
<div id="tags-pour-définir-le-namespace" class="section level5 unnumbered">
<h5>Tags pour définir le <code>NAMESPACE</code></h5>
<p></p>
<p>Il est aussi essentiel de mettre les tags pour l’écriture du <code>NAMESPACE</code> :</p>
<ul>
<li>le tag <code>@export</code> exporte une fonction du <code>NAMESPACE</code> (donc la rend publique),</li>
<li>le tag <code>@importFrom</code> assure l’importation des fonctions provenant d’autres packages qui sont utilisées dans le code de notre package.</li>
</ul>
<p>D’autres tags de cette catégorie sont documentés ici : <a href="https://roxygen2.r-lib.org/articles/namespace.html" class="uri">https://roxygen2.r-lib.org/articles/namespace.html</a></p>
</div>
</div>
</div>
<div id="générer-les-fichiers-.rd-et-le-fichier-namespace" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Générer les fichiers .Rd et le fichier <code>NAMESPACE</code></h2>
<p>Pour générer les fichiers <code>.Rd</code> et le fichier <code>NAMESPACE</code>, il suffit d’appeler la <a href="https://roxygen2.r-lib.org/reference/roxygenize.html">fonction <code>roxygenize</code></a> du package <code>roxygen2</code>. La <a href="https://devtools.r-lib.org/reference/document.html">fonction <code>document</code></a> du package <code>devtools</code> ou des fonctionnalités de RStudio peuvent aussi appeler cette fonction pour nous.</p>
<div id="exemple-6" class="section level4 unnumbered">
<h4>Exemple :</h4>
<p></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">document</span>()</span></code></pre></div>
<pre><code>## Updating manhattan documentation
## First time using roxygen2. Upgrading automatically...
## Loading manhattan
## Writing NAMESPACE
## Writing NAMESPACE
## Writing dist_manhattan.Rd
## Writing dist_manhattan_2.Rd
## Writing manhattan-package.Rd
## Writing points.Rd</code></pre>
<p> </p>
<p>Dans l’exemple présenté précédemment, les commentaires <code>roxygen</code> des fichiers <code>dist_manhattan.R</code>, <code>dist_manhattan_2.R</code>, <code>print.R</code> et <code>manhattan-package.R</code>, du sous-répertoire <code>C:/coursR/manhattan/R</code>, ont produit (ou modifié) les fichiers suivants :</p>
<ul>
<li><code>NAMESPACE</code> dans le répertoire <code>C:/coursR/manhattan/</code>;</li>
<li><code>dist_manhattan.Rd</code>, <code>dist_manhattan_2.Rd</code>, <code>points.Rd</code> et <code>manhattan-package.Rd</code> dans le répertoire <code>C:/coursR/manhattan/man/</code>.</li>
</ul>
<p>L’arborescence de répertoires et fichiers du package est donc maintenant la suivante.</p>
<pre><code>manhattan/
  |-- R/
      |-- dist_manhattan.R
      |-- dist_manhattan_2.R
      |-- print.R
      |-- manhattan-package.R
  |-- man/
      |-- dist_manhattan.Rd
      |-- dist_manhattan_2.Rd
      |-- manhattan-package.Rd
      |-- points.Rd
  |-- data/
      |-- points.rda
  |-- DESCRIPTION
  |-- NAMESPACE
  |-- manhattan.Rproj</code></pre>
<p> </p>
<p>Le fichier <code>C:/coursR/manhattan/NAMESPACE</code> est maintenant le suivant :</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generated by roxygen2: do not edit by hand</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">S3method</span>(print,distman)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="fu">export</span>(dist_manhattan)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="fu">export</span>(dist_manhattan_2)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="fu">importFrom</span>(stats,dist)</span></code></pre></div>
<p> </p>
<p>Voici de quoi a l’air un des fichiers d’extension <code>.Rd</code> généré.</p>
<p>Fichier <code>"C:/coursR/manhattan/man/dist_manhattan.Rd"</code> :</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode tikz"><code class="sourceCode latex"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">% Generated by roxygen2: do not edit by hand</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co">% Please edit documentation in R/dist_manhattan.R, R/print.R</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">\name</span>{dist_manhattan}</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="fu">\alias</span>{dist_manhattan}</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="fu">\alias</span>{print.distman}</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="fu">\title</span>{Distance de Manhattan}</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="fu">\usage</span>{</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>dist_manhattan(point1, point2)</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="fu">\method</span>{print}{distman}(x, ...)</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="fu">\arguments</span>{</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="fu">\item</span>{point1}{Un vecteur numerique des coordonnees du premier point.}</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="fu">\item</span>{point2}{Un vecteur numerique des coordonnees du deuxieme point.}</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="fu">\item</span>{x}{Un objet produit par la fonction <span class="fu">\code</span>{dist_manhattan} ou</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="fu">\code</span>{dist_manhattan_2}, a afficher.}</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a><span class="fu">\item</span>{<span class="fu">\dots</span>}{D&#39;autres arguments passes a d&#39;autres methodes.}</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a><span class="fu">\value</span>{</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>une seule valeur : la distance de Manhattan entre</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">\code</span>{point1} et <span class="fu">\code</span>{point2}</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a><span class="fu">\description</span>{</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>Calcule la distance de Manhattan entre deux points</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a><span class="kw">\section</span>{Methods (by generic)}{</span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a><span class="fu">\itemize</span>{</span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a><span class="fu">\item</span> <span class="fu">\code</span>{print}: Affiche un objet de classe <span class="fu">\code</span>{&quot;distman&quot;}</span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>}}</span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a><span class="fu">\examples</span>{</span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a>dist_manhattan(point1 = points[4, ], point2 = points[8, ])</span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a><span class="fu">\author</span>{</span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a>Sophie Baillargeon</span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p> </p>
<p>Ces fichiers utilisent une syntaxe inspirée de la syntaxe de LaTeX. Lorsque nous utilisons <code>roxygen2</code>, nous n’avons pas besoin d’éditer directement ces fichiers, donc nous n’avons pas besoin de comprendre leur syntaxe (à l’exception peut-être des tags de mise en forme). La syntaxe <code>roxygen</code> est plus simple.</p>
<p>Après construction et installation du package, cette fiche d’aide aura l’allure suivante :</p>
<div style="page-break-after: always;"></div>
<p> </p>
<p><img src="fig/fiche_aide.png" width="90%" style="display: block; margin: auto;" /></p>
<p> </p>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div id="étape-4.-vérifier-et-construire-le-package" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Étape 4. Vérifier et construire le package</h1>
<p>Une fois les étapes 1 à 3 complétées, nous sommes prêts à construire le fichier compressé du package à partir du répertoire contenant les fichiers source. En fait, nous allons d’abord à cette étape vérifier le répertoire afin de nous assurer qu’il produira un package conforme.</p>
<p>Ces tâches se réalisent avec les utilitaires R :</p>
<ul>
<li><code>R CMD check</code>,</li>
<li><code>R CMD build</code>,</li>
<li><code>R CMD INSTALL</code>.</li>
</ul>
<p>Ces utilitaires s’exploitent par des commandes soumises dans le <em>terminal</em> sous Linux ou macOS et dans une fenêtre <em>invite de commandes</em> sous Windows. Dans ces notes, nous verrons comment utiliser un outil qui soumet ces commandes à notre place, sans que nous ayons besoin d’ouvrir le terminal ou la fenêtre d’invite de commandes.</p>
<p>Les utilitaires <code>R CMD</code> <a href="https://stat.ethz.ch/R-manual/R-devel/library/utils/html/PkgUtils.html"><code>check</code>, <code>build</code></a> et <a href="http://stat.ethz.ch/R-manual/R-devel/library/utils/html/INSTALL.html"><code>INSTALL</code></a> sont inclus dans l’installation de base de R (dans le package <code>utils</code>). Cependant, ils nécessitent des outils supplémentaires pour fonctionner : les outils de développement de logiciel GNU, incluant un compilateur C/C++. Voici comment s’assurer que ces outils sont installés sur notre ordinateur, selon le système d’exploitation (plus de détails sur la page <a href="https://support.rstudio.com/hc/en-us/articles/200486498-Package-Development-Prerequisites)\" class="uri">https://support.rstudio.com/hc/en-us/articles/200486498-Package-Development-Prerequisites)\</a> :</p>
<ul>
<li><p>Windows : il faut installer les « Rtools », téléchargeable sur la page web <a href="https://cran.r-project.org/bin/windows/Rtools/" class="uri">https://cran.r-project.org/bin/windows/Rtools/</a> (plus de détails dans le <a href="https://stt4230.rbind.io/introduction/installation_r_rstudio/#rtools">Guide d’installation ou de mise à jour de R et RStudio</a>);</p></li>
<li><p>macOS : il faut installer les « Xcode command line tools », disponibles gratuitement, s’ils ne sont pas déjà installés (plus de détails dans le <a href="https://stt4230.rbind.io/introduction/installation_r_rstudio/#xcode">Guide d’installation ou de mise à jour de R et RStudio</a>);</p></li>
<li><p>Linux : il faut s’assurer d’avoir installé R accompagné des ses « development tools » (<code>r-base-dev</code>).</p></li>
</ul>
<p>Le <a href="https://CRAN.R-project.org/package=pkgbuild">package <code>pkgbuild</code></a> comporte une fonction pour tester si tout le nécessaire au développement de package est installé et fonctionne correctement.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>pkgbuild<span class="sc">::</span><span class="fu">has_build_tools</span>()</span></code></pre></div>
<p>Si cet appel à la fonction <code>pkgbuild::has_build_tools</code> retourne <code>TRUE</code>, alors tout est fonctionnel.</p>
<p>De plus, une des commandes R pour le développement de packages, soit <code>R CMD check</code>, a besoin d’une installation de LaTeX pour tester la création de la documentation des packages en format PDF. Pour développer des packages, vous avez donc le choix entre :</p>
<ul>
<li>installer LaTeX sur votre ordinateur (tel que mentionné dans le <a href="https://stt4230.rbind.io/introduction/installation_r_rstudio/#latex">Guide d’installation ou de mise à jour de R et RStudio</a>) :
<ul>
<li>un compilateur LaTeX multiplateforme gratuit est MiKTeX (<a href="https://miktex.org/download" class="uri">https://miktex.org/download</a>),</li>
<li>un autre compilateur LaTeX gratuit pour macOS est MacTeX (<a href="http://www.tug.org/mactex/" class="uri">http://www.tug.org/mactex/</a>),</li>
<li>les systèmes Linux viennent habituellement par défaut avec une distribution de LaTeX;</li>
</ul></li>
<li>omettre la création de la documentation PDF lors de la soumission de la commande <code>R CMD check</code> grâce à l’option <code>--no-manual</code> (plus d’informations à venir en temps opportun).</li>
</ul>
<div id="lancement-des-commandes-de-vérification-et-de-construction-avec-devtools" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Lancement des commandes de vérification et de construction avec <code>devtools</code></h2>
<p>Les commandes de construction et de vérification d’un package peuvent être soumises à l’aide de fonctions du package <code>devtools</code>. Ces fonctions permettent de soumettre des commandes <code>R CMD</code> sans passer par le terminal ou l’invite de commandes, ce qui simplifie vraiment le processus. Avec <code>devtools</code>, tout se réalise via des commandes soumises dans la console R.</p>
<div id="vérification-de-package-avec-la-fonction-devtoolscheck" class="section level3" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> Vérification de package avec la fonction <code>devtools::check</code></h3>
<p>Il est recommandé de d’abord vérifier le package avant de le construire. Cette vérification se lance avec <code>devtools</code> grâce à la <a href="https://devtools.r-lib.org/reference/check.html">fonction <code>check</code></a>.</p>
<div id="exemple-7" class="section level4" number="4.1.1.1">
<h4><span class="header-section-number">4.1.1.1</span> Exemple :</h4>
<p></p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">check</span>()</span></code></pre></div>
<p>L’impression produite est plutôt longue et n’est donc pas présentée ici. Si des erreurs sont détectées, il faut les régler. Les messages d’erreur peuvent nous aider à comprendre le problème. Faire une recherche internet avec le message d’erreur intégral (p. ex. encadré de guillemets dans Google) est aussi souvent informatif.</p>
<p>Nous souhaitons aussi éviter les avertissements. Il est recommandé de les régler autant que possible.</p>
<p>Par défaut, la fonction <code>devtools::check</code> appelle d’abord la fonction <code>devtools::document</code>, ce qui assure que la documentation est à jour avant de vérifier le package.</p>
<p>Notons aussi que la fonction <code>devtools::check</code> possède un argument <code>cran</code> prenant la valeur par défaut <code>TRUE</code>, ce qui signifie que la commande <code>R CMD check</code> est lancée avec l’option <code>--as-cran</code>. Pour omettre cette option, il faut appeler la fonction <code>devtools::check</code> comme suit :</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">check</span>(<span class="at">cran =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><strong>Note</strong> : Si vous n’avez pas de compilateur LaTeX sur votre ordinateur, ajoutez aussi l’argument <code>manual = FALSE</code>. Cette fonction indique à <code>R CMD check</code> de ne pas vérifier la compilation de la version PDF de la documentation du package.</p>
</div>
</div>
<div id="construction-de-package-avec-la-fonction-devtoolsbuild" class="section level3" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Construction de package avec la fonction <code>devtools::build</code></h3>
<p>Une fois satisfaits des résultats de la vérification, nous pouvons passer à l’étape ultime : construire le package. Cette étape permet d’obtenir une archive (fichier compressé) contenant le package. Nous avons vu dans les notes sur l’<a href="https://stt4230.rbind.io/packages/utilisation_packages_r/#%C3%A0-partir-du-cran">utilisation de packages R</a> que ceux-ci sont distribués sous trois formats d’archive différents :</p>
<ul>
<li><code>.tar.gz</code> (<em>package source</em>) pour Linux,</li>
<li><code>.zip</code> pour Windows,</li>
<li><code>.tgz</code> pour macOS.</li>
</ul>
<p>Tous ces formats d’archive peuvent être créés avec la <a href="https://devtools.r-lib.org/reference/build.html">fonction <code>build</code></a> du package <code>devtools</code>. Pour créer le package source (<code>.tar.gz</code>), aucun argument n’a à être fourni en entrée à la fonction. Celle-ci lance en fait la commande <code>R CMD build</code> et un fichier nommé <code>"nomPackage_numeroVersion.tar.gz"</code> (dans notre exemple<br />
<code>manhattan_1.0.0.tar.gz</code>) est créé dans le répertoire contenant le répertoire principal du package (donc le répertoire parent du répertoire portant le nom du package).</p>
<p>Les archives de format <code>.zip</code> et <code>.tgz</code> sont des versions dites binaires d’un package. La fonction <code>devtools::build</code> avec l’argument <code>binary = TRUE</code> permet de les créer. Avec cet argument, cette fonction lance en fait la commande <code>R CMD INSTALL --build</code>. Si cette commande est lancée à partir d’un système d’exploitation Windows, une archive <code>.zip</code> est créée, alors que c’est plutôt une archive <code>.tgz</code> qui est créée lorsque la commande est lancée à partir d’un système d’exploitation macOS. Le fichier sera nommé <code>nomPackage_numeroVersion.zip</code> (sous Windows) ou <code>nomPackage_numeroVersion.tgz</code> (sous macOS) et créé dans le répertoire au-dessus du répertoire principal du package.</p>
<div id="exemple-8" class="section level4 unnumbered">
<h4>Exemple :</h4>
<p></p>
<p>Voici ce que j’obtiens en créant les versions source et binaire de notre package sur mon ordinateur, qui est sous système d’exploitation Windows.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">build</span>()</span></code></pre></div>
<pre><code>## √  checking for file &#39;C:\coursR\manhattan/DESCRIPTION&#39; (435ms)
## -  preparing &#39;manhattan&#39;: (374ms)
## √  checking DESCRIPTION meta-information ...
## -  checking for LF line-endings in source and make files and shell scripts
## -  checking for empty or unneeded directories
## -  building &#39;manhattan_1.0.0.tar.gz&#39;
##    
## [1] &quot;C:/coursR/manhattan_1.0.0.tar.gz&quot;</code></pre>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">build</span>(<span class="at">binary =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## -  installing to library &#39;C:/Users/Sophie/AppData/Local/Temp/Rtmpwpubsf/temp_libpath3d403f3b5c1&#39; (375ms)
## -  installing *source* package &#39;manhattan&#39; ...
##    ** using staged installation
##    ** R
##    ** data
##    *** moving datasets to lazyload DB
##    ** byte-compile and prepare package for lazy loading
##    ** help
##    *** installing help indices
##      converting help for package &#39;manhattan&#39;
##        finding HTML links ... done
##        dist_manhattan                          html  
##        dist_manhattan_2                        html  
##        manhattan-package                       html  
##        points                                  html  
##    ** building package indices
##    ** testing if installed package can be loaded from temporary location
##    *** arch - i386
##    *** arch - x64
##    ** testing if installed package can be loaded from final location
##    *** arch - i386
##    *** arch - x64
##    ** testing if installed package keeps a record of temporary installation path
## -  MD5 sums
##    packaged installation of &#39;manhattan&#39; as manhattan_1.0.0.zip
## -  DONE (manhattan)
## [1] &quot;C:/coursR/manhattan_1.0.0.zip&quot;</code></pre>
</div>
</div>
<div id="accès-à-nos-fonctions-en-cours-de-développement" class="section level3" number="4.1.3">
<h3><span class="header-section-number">4.1.3</span> Accès à nos fonctions en cours de développement</h3>
<p>Pour charger la définition de nos fonctions en cours de développement, par exemple pour les tester interactivement, la <a href="https://devtools.r-lib.org/reference/load_all.html">fonction <code>load_all</code></a> du package <code>devtools</code> est utile. Elle simule un chargement du package avec <code>library</code> sans réellement installer le package.</p>
<p>Pour vraiment installer le package, nous pouvons utiliser la <a href="https://devtools.r-lib.org/reference/install.html">fonction install</a> du package <code>devtools</code>. La feuille de triche du package devtools décrit schématiquement les différences entre ces fonctions : <a href="https://rawgit.com/rstudio/cheatsheets/master/package-development.pdf" class="uri">https://rawgit.com/rstudio/cheatsheets/master/package-development.pdf</a></p>
</div>
</div>
<div id="lancement-des-commandes-de-vérification-et-de-construction-en-rstudio" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Lancement des commandes de vérification et de construction en RStudio</h2>
<p><strong>RStudio</strong> peut aussi <a href="https://support.rstudio.com/hc/en-us/articles/200486488?version=1.1.423&amp;mode=desktop">lancer pour nous les commandes de construction et de vérification de packages</a>.</p>
<p>Cette sous-section explique comment réaliser avec des menus de RStudio ce que nous venons de réaliser avec des fonctions du package <code>devtools</code>. Il s’agit d’une méthode de remplacement en cas de problèmes. Si tout a bien fonctionné à la sous-section précédente, ce qui est présenté ici ne nous est pas utile.</p>
<div id="sous-étape-a-créer-un-projet-rstudio-avec-le-répertoire-principal-du-package" class="section level4 unnumbered">
<h4>Sous-étape a) Créer un projet RStudio avec le répertoire principal du package</h4>
<p></p>
<p>Si nous n’avions pas utilisé la fonction <code>usethis::create_package</code> pour créer le répertoire principal du package, celui-ci ne serait peut-être pas un projet RStudio. S’il ne l’était pas, il faudrait tout d’abord créer un projet RStudio avec le répertoire principal de notre package. Pour ce faire, nous pourrions procéder comme suit :</p>
<ul>
<li>ouvrir le menu « File » et sélectionner « New Project… » (il y a aussi un bouton dans la barre de RStudio en haut à droite, nommé à l’origine « Project: (None) » qui ouvre un menu contenant aussi l’élément « New Project… »),</li>
<li>sélectionner « Existing Directory »,</li>
<li>sélectionner le répertoire principal du package, c’est-à-dire le répertoire portant le nom du package et contenant les fichiers source,</li>
<li>cliquer sur « Create Project ».</li>
</ul>
<p>Le projet sera créé et ouvert. Ça ajoute des fichiers dans le répertoire de notre package. Nous ne nous préoccuperons pas de ces fichiers. Ils sont automatiquement ignorés lors de la construction du package avec RStudio.</p>
<p><strong>Note</strong> : Si nous sélectionnons « New Directory » plutôt que « Existing Directory », puis « R package », RStudio crée un squelette de répertoire de fichiers source de package.</p>
</div>
<div id="sous-étape-b-configurer-les-options-de-rstudio" class="section level4 unnumbered">
<h4>Sous-étape b) Configurer les options de RStudio</h4>
<p></p>
<p>Voici quelques configurations de RStudio que je conseille d’utiliser.</p>
<div id="options-globales" class="section level5 unnumbered">
<h5>Options globales :</h5>
<p></p>
<p>(à modifier une seule fois)</p>
<ul>
<li>par le menu « Tools &gt; Global Options… »,</li>
<li>dans « Packages », décocher « Cleanup output after successful R CMD check ».</li>
</ul>
<p>Les répertoires générés par la commande <code>R CMD check</code> ne seront ainsi pas effacés et nous pourrons, par exemple, aller y récupérer la version PDF de la documentation du package.</p>
</div>
<div id="options-du-projet" class="section level5 unnumbered">
<h5>Options du projet :</h5>
<p></p>
<p>(à modifier pour chaque nouveau projet)</p>
<ul>
<li>par le menu « Tools &gt; Project Options… »;</li>
<li>dans « Build Tools » :
<ul>
<li>cocher « Generate documentation with Roxygen »,</li>
<li>si le menu de configuration ne s’ouvre pas automatiquement, cliquez sur « Configure… », puis assurez-vous que les options suivantes soient cochées :
<ul>
<li>« Use roxygen to generate » : « Rd files » et « NAMESPACE »,</li>
<li>« Automatically roxygenize when running » : tout cocher.</li>
</ul></li>
</ul></li>
</ul>
<!--
    + décocher «\ Use devtools package functions if available\ » (seulement nécessaire si nous souhaitons que la commande `R CMD check` génère la version PDF de la documentation du package),
-->
<p>Avec ces dernières configurations, la majorité des commandes de construction et de vérification de package lancées par le menu « Build » (voir ci-dessous) vont d’abord soumettre la commande <code>roxygenize</code> sur le répertoire du package avant de faire leur travail. Ainsi, les fichiers <code>.Rd</code> de documentation et le fichier <code>NAMESPACE</code> seront mis à jour à chaque lancement d’une de ces commandes</p>
<p>Nous pouvons aussi soumettre la commande <code>roxygenize</code> par le menu « <strong>Build &gt; Document</strong> ».</p>
<p><strong>Note</strong> : Si vous n’avez pas de compilateur LaTeX sur votre ordinateur, ajoutez l’option suivante à <code>R CMD check</code> : <code>--no-manual</code>. Cette fonction indique à <code>R CMD check</code> de ne pas vérifier la compilation de la version PDF de la documentation du package.</p>
</div>
</div>
<div id="sous-étape-c-vérifier-ou-construire-à-partir-du-menu-build-de-rstudio" class="section level4 unnumbered">
<h4>Sous-étape c) Vérifier ou construire à partir du menu « Build » de RStudio</h4>
<p></p>
<p>Il est préférable de toujours d’abord s’assurer que le package passe sans erreur ou avertissements problématiques la vérification faite par la commande <code>R CMD check</code>. Ensuite, nous pouvons construire le package, soit dans sa version source, soit dans sa version binaire. Voici comment faire tout ça facilement en RStudio.</p>
<ul>
<li><p>Pour vérifier le package :<br />
menu « <strong>Build &gt; Check Package</strong> » (lance en fait la commande <code>R CMD check</code>).</p></li>
<li><p>Pour créer le package source (qui est aussi la version Linux) :<br />
menu « <strong>Build &gt; Build Source Package</strong> » (lance en fait la commande <code>R CMD build</code>)<br />
<span class="math inline">\(\rightarrow\)</span> un fichier nommé <code>"nomPackage_numeroVersion.tar.gz"</code> sera créé dans le répertoire au-dessus du répertoire principal du package.</p></li>
<li><p>Pour créer le package binaire (si nous travaillons sous Windows ou macOS) :<br />
menu « <strong>Build &gt; Build Binary Package</strong> » (lance en fait la commande <code>R CMD INSTALL --build</code>)<br />
<span class="math inline">\(\rightarrow\)</span> un fichier nommé <code>nomPackage_numeroVersion.zip</code> (sous Windows) ou <code>nomPackage_numeroVersion.tgz</code> (sous macOS) sera créé dans le répertoire au-dessus du répertoire principal du package.</p></li>
</ul>
<p>La commande « <strong>Install and Restart</strong> » est pratique en cours de travail. Elle permet de :</p>
<ul>
<li>construire le package dans le bon format pour notre système d’exploitation,</li>
<li>l’installer (donc remplacer l’ancienne installation par la nouvelle) et</li>
<li>charger de nouveau le package (avec la commande <code>library</code>).</li>
</ul>
<p>Vous trouverez en annexe des solutions à certains problèmes techniques déjà rencontrés lors du lancement d’une commande <code>R CMD</code>.</p>
</div>
</div>
</div>
<div id="étape-5.-si-désiré-partager-le-package" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Étape 5. Si désiré, partager le package</h1>
<p>Notre package est maintenant prêt à être utilisé. Si nous souhaitons le partager avec le grand public, nous pouvons le rendre disponible sur le CRAN. Pour ce faire, il faut d’abord s’assurer de respecter les politiques du CRAN : <a href="http://cran.r-project.org/web/packages/policies.html" class="uri">http://cran.r-project.org/web/packages/policies.html</a>. Comme mentionné précédemment, il faut donc que notre package passe le <code>R CMD check --as-cran</code> sans erreurs ni avertissements.</p>
<p>Une fois s’être assuré de respecter les politiques du CRAN, nous pouvons soumettre notre package au CRAN en ligne par l’intermédiaire de l’interface web suivante : <a href="https://cran.r-project.org/submit.html" class="uri">https://cran.r-project.org/submit.html</a></p>
<p>Il suffit de suivre les instructions.</p>
</div>
<div id="étape-6.-au-besoin-mettre-à-jour-le-package" class="section level1" number="6">
<h1><span class="header-section-number">6</span> Étape 6. Au besoin, mettre à jour le package</h1>
<p>Mettre à jour un package signifie de le modifier pour ajouter des fonctionnalités et/ou corriger des bogues. Lors d’une mise à jour, il faut suivre les étapes suivantes.</p>
<div id="sous-étape-a-incrémenter-le-numéro-de-version" class="section level4 unnumbered">
<h4>Sous-étape a) Incrémenter le numéro de version :</h4>
<p></p>
<p>Cette incrémentation doit être effectuée dans le fichier <code>DESCRIPTION</code>, ainsi que dans tout commentaire <code>roxygen</code> mentionnant la date de construction du package, par exemple dans la fiche d’aide du package.</p>
<p>Rappelons qu’un numéro de version est une séquence d’au minimum 2 (souvent 3, parfois 4) nombres entiers non négatifs séparés par un seul caractère caractère <code>.</code> (point) ou <code>-</code> (tiret). Ces nombres ne sont pas contraints à être compris entre 0 et 9.</p>
<p>Voici les règles que plusieurs développeurs de packages R suivent dans la numérotation des versions de leurs packages. Ils forment les numéros de version de 3 nombres entiers séparés par un point. En cours de développement, soit avant d’avoir une version considérée suffisamment testée, ils utilisent un 0 comme premier nombre dans le numéro de version (par exemple 0.9.12). Lorsqu’ils jugent leur package assez fiable pour être rendu disponible à plus grande échelle qu’à l’interne, ils changent le premier nombre dans le numéro de version pour 1, ce qui fait retomber à zéro les nombres suivants. La première version officielle porte donc le numéro de version 1.0.0.</p>
<p>Ensuite, ils font évoluer les numéros de version comme suit.</p>
<ul>
<li><p>Lors d’une mise à jour majeure (beaucoup de nouvelles fonctionnalités) : le premier nombre de la numérotation est incrémenté de 1, les nombres subséquents retombent à 0.</p></li>
<li><p>Lors d’une mise à jour mineure (seulement quelques fonctionnalités pas trop importantes ont été ajoutées ou d’importants bogues ont été réglés) : le premier nombre est inchangé, par contre le deuxième est incrémenté de 1 et le dernier retombe à 0.</p></li>
<li><p>Si seulement quelques bogues ont été corrigés, sans changer du tout les fonctionnalités : le troisième nombre de la numérotation est incrémenté de 1, sans modifier les deux premiers nombres.</p></li>
</ul>
<p>La page Wikipédia <a href="https://en.wikipedia.org/wiki/Software_versioning" class="uri">https://en.wikipedia.org/wiki/Software_versioning</a> traite de ce sujet et propose d’autres règles.</p>
</div>
<div id="sous-étape-b-faire-les-mises-à-jour-dans-le-code" class="section level4 unnumbered">
<h4>Sous-étape b) Faire les mises à jour dans le code :</h4>
<p></p>
<p>L’ajout de fonctionnalités ou la correction de bogues impliquent des modifications à apporter au code.</p>
</div>
<div id="sous-étape-c-documenter-les-mises-à-jour" class="section level4 unnumbered">
<h4>Sous-étape c) Documenter les mises à jour :</h4>
<p></p>
<p>Les commentaires <code>roxygen</code> produisant les fiches d’aide doivent être mis à jour de façon à refléter les modifications apportées au code. Une correction d’un bogue ne nécessite pas toujours de mise à jour des fiches d’aide, mais un ajout de fonctionnalités en nécessite toujours.</p>
<p>Je conseille vivement aussi de documenter les mises à jour dans un fichier <code>NEWS</code>. Ce fichier est un point de repère pour un utilisateur d’un package qui souhaite identifier ce qui a changé lors d’une mise à jour, donc ce qui pourrait affecter son utilisation du package.</p>
<p>Il n’y a pas de consensus en R à propos de comment rédiger le fichier <code>NEWS</code>, ni de l’endroit où le placer dans les fichiers source. Nous pouvons observer, notamment, les pratiques suivantes :</p>
<ul>
<li>fichier <code>NEWS</code> en format texte simple (dont le nom de fichier ne porte pas d’extension), placé dans le répertoire principal (au même niveau que les fichiers <code>DESCRIPTION</code> et <code>NAMESPACE</code>);</li>
<li>fichier <code>NEWS.md</code> en format Markdown, placé dans le répertoire principal;</li>
<li>fichier <code>NEWS</code> en format texte simple (dont le nom de fichier ne porte pas d’extension), placé dans le sous-répertoire <code>inst</code>;</li>
<li>fichier <code>NEWS.Rd</code> en format <code>.Rd</code>, placé dans le sous-répertoire <code>inst</code>.</li>
</ul>
<p>La première des pratiques est probablement la plus répandue.</p>
<p>Voici à quoi pourrait ressembler un fichier <code>NEWS</code> en format texte simple pour l’exemple du package <code>manhattan</code>, après l’avoir mis à jour.</p>
<p>Fichier <code>"C:/coursR/manhattan/NEWS"</code> :</p>
<pre><code>Changements dans manhattan version 1.1.0 (2021-04-06)
 
* modifications des fonctions dist_manhattan et dist_manhattan_2 afin qu&#39;elles
  puissent calculer la distance entre plusieurs points

* ajout d&#39;une methode plot pour un objet de classe &quot;distman&quot;
 

Changements dans manhattan version 1.0.0 (2021-03-29)

* premiere version du package manhattan</code></pre>
<p> </p>
<p>Nous pourrions également utiliser le commande <code>usethis::use_news_md()</code> pour produire un gabarit de fichier <code>NEWS.md</code> qu’il ne nous resterait plus qu’à éditer.</p>
<p>Si nous installions la version 1.1.0 du package, nous pourrions afficher son fichier <code>NEWS</code> avec les instructions suivantes :</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">news</span>(<span class="at">package =</span> <span class="st">&quot;manhattan&quot;</span>)</span></code></pre></div>
<p>Nous pouvons aussi voir le fichier <code>NEWS</code> des packages distribués sur le CRAN directement sur leur page web du CRAN (dans le champ <code>Materials</code>).</p>
</div>
<div id="sous-étape-d-revérifier-et-reconstruire-le-package" class="section level4 unnumbered">
<h4>Sous-étape d) Revérifier et reconstruire le package</h4>
<p></p>
<p>Il faut finalement construire et vérifier de nouveau le package. Un nouveau fichier compressé sera produit, portant le nom du package accompagné du nouveau numéro de version.</p>
<hr />
</div>
</div>
<div id="résumé" class="section level1" number="7">
<h1><span class="header-section-number">7</span> Résumé</h1>
<p>Étapes de création d’un package R</p>
<div id="écrire-les-fonctions" class="section level4 unnumbered">
<h4>1. Écrire les fonctions</h4>
<p></p>
<p>Objets utilisables dans le corps des fonctions d’un package :</p>
<ul>
<li>arguments et variables locales,</li>
<li>tout objet, public ou privé, contenu dans le package,</li>
<li>objets provenant d’autres packages, à la condition d’inclure ces objets dans <em>l’environnement des objets importés par le package</em>,</li>
<li>objets du package R de base.</li>
</ul>
<p>Bonne pratique : Utiliser la forme <code>&lt;nomPackage&gt;::&lt;nomFonction&gt;()</code> pour appeler les fonctions provenant d’autres packages (sauf pour celles provenant du package <code>base</code>).</p>
<p>Si but = mettre sur le CRAN <span class="math inline">\(\rightarrow\)</span> respecter <a href="http://cran.r-project.org/web/packages/policies.html" class="uri">http://cran.r-project.org/web/packages/policies.html</a></p>
</div>
<div id="créer-larborescence-de-répertoires-et-fichiers-du-package" class="section level4 unnumbered">
<h4>2. Créer l’arborescence de répertoires et fichiers du package</h4>
<p></p>
<p>Répertoire principal, portant le nom du package, contenant :</p>
<ul>
<li>sous-répertoire nommé <code>R</code> : répertoire des fichiers contenant le code source R des fonctions;</li>
<li>sous-répertoire nommé <code>man</code> : répertoire des fichiers source des fiches d’aide;</li>
<li>sous-répertoire nommé <code>data</code> : répertoire pour les jeux de données publics (au besoin);</li>
<li>fichier nommé <code>DESCRIPTION</code> : informations descriptives générales du package (configurations);</li>
<li>fichier nommé <code>NAMESPACE</code> : fichier permettant de définir quels objets sont publics (exportés) et d’identifier les fonctions d’autres packages (excluant le package <code>base</code>) utilisées dans le package (objets importés);</li>
<li>autres éléments, selon les besoins : fichier <code>NEWS</code>, sous-répertoire <code>src</code>, etc.</li>
</ul>
<p>Fonctions du package <code>usethis</code> utiles à cette étape :</p>
<ul>
<li><code>create_package</code> : création de l’arborescence de base, dans un projet RStudio;</li>
<li><code>use_r</code> : création de fichiers script R dans le sous-répertoire nommé <code>R</code>;</li>
<li><code>use_data</code> : ajout de jeux de données dans le sous-répertoire nommé <code>data</code>.</li>
</ul>
</div>
<div id="écrire-la-documentation-des-fonctions-et-du-package" class="section level4 unnumbered">
<h4>3. Écrire la documentation des fonctions et du package</h4>
<p></p>
<p>Éléments à documenter :</p>
<ul>
<li>les fonctions publiques,</li>
<li>les jeux de données,</li>
<li>les classes et méthodes S4 ou RC publiques,</li>
<li>les méthodes S3 pour des fonctions génériques (si pertinent),</li>
<li>le package lui-même (recommandé).</li>
</ul>
<p><strong>Documentation d’un package avec <code>roxygen2</code> :</strong></p>
<p>Commentaires dans le code source R pour générer les fiches d’aide (contenu du sous-répertoire <code>man</code>) et le fichier <code>NAMESPACE</code></p>
<ul>
<li>symbole de commentaire <code>roxygen</code> : <code>#'</code>;</li>
<li>commentaires en entête des fonctions ou
<ul>
<li>avant <code>"_PACKAGE"</code> pour la fiche d’aide globale du package,</li>
<li>avant une chaîne de caractères contenant le nom d’un objet contenant des données;</li>
</ul></li>
<li>1<sup>ère</sup> ligne <span class="math inline">\(\rightarrow\)</span> titre de la fiche, suivi d’une ligne vide;</li>
<li>1<sup>er</sup> paragraphe <span class="math inline">\(\rightarrow\)</span> champ <code>Descripion</code> de la fiche, suivi d’une ligne vide;</li>
<li>autres paragraphes (optionnels) <span class="math inline">\(\rightarrow\)</span> champ <code>Details</code>;</li>
<li>tags :
<ul>
<li><code>@param</code> : description des paramètres <span class="math inline">\(\rightarrow\)</span> champ <code>Arguments</code>;</li>
<li><code>@return</code> : description de la sortie <span class="math inline">\(\rightarrow\)</span> champ <code>Value</code>;</li>
<li>pour le fichier <code>NAMESPACE</code> : <code>@export</code>, <code>@importFrom</code>, etc.;</li>
<li>autres sections : <code>@examples</code>, <code>@author</code>, <code>@references</code>, <code>@format</code>, etc.;</li>
<li>pour jumeler des fiches : <code>@describeIn</code>, <code>@rdname</code>;</li>
<li>métadonnées : <code>@name</code>, <code>@aliases</code>, etc.</li>
</ul></li>
</ul>
<p>Pour générer la documentation : <code>devtools::document()</code> ou <code>devtools::check()</code></p>
</div>
<div id="vérifier-et-construire-le-package" class="section level4 unnumbered">
<h4>4. Vérifier et construire le package</h4>
<p></p>
<p>Installations nécessaires :</p>
<ul>
<li>R,</li>
<li><a href="https://stt4230.rbind.io/packages/devel_packages_r/#%C3%A9tape-4.-v%C3%A9rifier-et-construire-le-package">outils de développement de logiciel GNU</a>,</li>
<li>compilateur LaTeX (uniquement pour générer la documentation au format PDF).</li>
</ul>
<p><strong><code>R CMD check</code></strong></p>
<p>Effectue diverses vérifications du package :<br />
- option <code>--as-cran</code> avant de soumettre an CRAN,<br />
- option <code>--no-manual</code> si aucun compilateur LaTeX n’est installé sur notre ordinateur.</p>
<p><strong><code>R CMD build</code></strong></p>
<p>Construit le package source (.tar.gz, = version Linux).</p>
<p><strong><code>R CMD INSTALL --build</code></strong></p>
<p>Construit le package binaire (.zip sous Windows, .tgz sous macOS )</p>
<p><strong>Vérifier et construire le package avec le package <code>devtools</code> :</strong></p>
<p>Fonctions du package <code>devtools</code> (à appeler dans la console) :</p>
<ul>
<li><code>check</code> : vérification, par défaut active l’option <code>--as-cran</code>;</li>
<li><code>build</code> : construction, par défaut crée le package source, version binaire obtenue avec <code>binary = TRUE</code>;</li>
<li><code>load_all</code> : utile en cours de développement pour charger les fonctions dans la session;</li>
<li><code>install</code> : installation locale du package.</li>
</ul>
<p><strong>Vérifier et construire le package avec RStudio :</strong></p>
<ul>
<li>Sous-étape a) Créer un projet RStudio avec notre package</li>
<li>Sous-étape b) Configurer les options de RStudio</li>
<li>Sous-étape c) Compiler à partir du menu « <strong>Build</strong> » de RStudio
<ul>
<li>vérifier le package : menu « <strong>Build &gt; Check Package</strong> »,</li>
<li>créer le package source : menu « <strong>Build &gt; Build Source Package</strong> »,</li>
<li>créer le package binaire : menu « <strong>Build &gt; Build Binary Package</strong> ».</li>
</ul></li>
</ul>
</div>
<div id="si-désiré-partager-le-package" class="section level4 unnumbered">
<h4>5. Si désiré, partager le package</h4>
<p></p>
<p>Il n’est pas compliqué de soumettre un package au CRAN : <a href="https://cran.r-project.org/submit.html" class="uri">https://cran.r-project.org/submit.html</a></p>
</div>
<div id="au-besoin-mettre-à-jour-le-package" class="section level4 unnumbered">
<h4>6. Au besoin, mettre à jour le package</h4>
<p></p>
<p>Mise à jour = modification pour ajouter des fonctionnalités et/ou corriger des bogues :</p>
<ul>
<li>Sous-étape a) Incrémenter le numéro de version dans le fichier DESCRIPTION (et dans la fiche d’aide du package s’il y est mentionné)</li>
<li>Sous-étape b) Faire les mises à jour dans le code</li>
<li>Sous-étape c) Documenter les mises à jour :
<ul>
<li>mettre à jour les commentaires <code>roxygen</code> produisant les fiches d’aide</li>
<li>décrire brièvement les changements dans fichier <code>NEWS</code> ou <code>NEWS.md</code><br />
(non obligatoire, mais c’est une bonne pratique)</li>
</ul></li>
<li>Sous-étape d) Reconstruire et revérifier le package</li>
</ul>
<hr />
</div>
</div>
<div id="références" class="section level1 unnumbered">
<h1>Références</h1>
<ul>
<li>R Core Team (2021). <em>Writing R Extensions</em>. R Foundation for Statistical Computing. Chapitres 1 et 2.<br />
URL <a href="https://cran.r-project.org/doc/manuals/r-release/R-exts.html" class="uri">https://cran.r-project.org/doc/manuals/r-release/R-exts.html</a></li>
<li>Wickham, H. (2015). <em>R packages</em>. O’Reilly Media, Inc. 
<ul>
<li>URL première édition (quelques informations dans cette version sont déjà obsolètes) :<br />
<a href="http://r-pkgs.had.co.nz/" class="uri">http://r-pkgs.had.co.nz/</a></li>
<li>URL deuxième édition (en développement) : <a href="https://r-pkgs.org" class="uri">https://r-pkgs.org</a>
<ul>
<li>Bon chapitre résumé : <a href="https://r-pkgs.org/whole-game.html" class="uri">https://r-pkgs.org/whole-game.html</a></li>
</ul></li>
</ul></li>
</ul>
<p>Packages exploités dans ces notes :</p>
<ul>
<li>Wickham, H., Danenberg, P., Csárdi, G. et Eugster, M. (2020). roxygen2: In-Line Documentation for R. R package version 7.1.1. URL <a href="https://CRAN.R-project.org/package=roxygen2" class="uri">https://CRAN.R-project.org/package=roxygen2</a>
<ul>
<li>URL documentation en ligne <a href="https://roxygen2.r-lib.org/" class="uri">https://roxygen2.r-lib.org/</a></li>
</ul></li>
<li>Wickham, H. et Bryan, J. (2021). usethis: Automate Package and Project Setup. R package version 2.0.1. URL <a href="https://CRAN.R-project.org/package=usethis" class="uri">https://CRAN.R-project.org/package=usethis</a>
<ul>
<li>URL documentation en ligne <a href="https://usethis.r-lib.org/" class="uri">https://usethis.r-lib.org/</a></li>
</ul></li>
<li>Wickham, H., Hester, J. et Chang, W. (2020). devtools: Tools to Make Developing R Packages Easier.
R package version 2.3.2. <a href="https://CRAN.R-project.org/package=devtools" class="uri">https://CRAN.R-project.org/package=devtools</a>
<ul>
<li>URL documentation en ligne <a href="https://devtools.r-lib.org/" class="uri">https://devtools.r-lib.org/</a></li>
<li>feuille de triche <a href="https://rawgit.com/rstudio/cheatsheets/master/package-development.pdf" class="uri">https://rawgit.com/rstudio/cheatsheets/master/package-development.pdf</a></li>
</ul></li>
</ul>
<p>Tutoriel sur le web concernant le développement de packages R en utilisant les packages <code>usethis</code> et <code>devtools</code> :</p>
<ul>
<li>Bryan, J., Hester, J. et Wickham, H. (2019). Tutoriel présenté dans le cadre de la conférence UseR 2019 intitulé « Package Development ». URL <a href="https://github.com/jennybc/pkg-dev-tutorial" class="uri">https://github.com/jennybc/pkg-dev-tutorial</a></li>
<li>Dray, M. (2019). Tutoriel web intitulé « Build an R package with {usethis} ». URL <a href="https://www.rostrum.blog/2019/11/01/usethis/" class="uri">https://www.rostrum.blog/2019/11/01/usethis/</a></li>
<li>Gelfand, S. (2019). Tutoriel web intitulé « usethis for reporting ». URL <a href="https://sharla.party/post/usethis-for-reporting/" class="uri">https://sharla.party/post/usethis-for-reporting/</a></li>
<li>Meyer, C. et Hammerschmidt, D. (2020). Tutoriel web intitulé « How to write your own R package and publish it on CRAN ». URL <a href="https://www.mzes.uni-mannheim.de/socialsciencedatalab/article/r-package/" class="uri">https://www.mzes.uni-mannheim.de/socialsciencedatalab/article/r-package/</a></li>
<li>Pileggi, S. (2020). Tutoriel web intitulé « Your first R package in 1 hour ». URL <a href="https://www.pipinghotdata.com/posts/2020-10-25-your-first-r-package-in-1-hour/" class="uri">https://www.pipinghotdata.com/posts/2020-10-25-your-first-r-package-in-1-hour/</a></li>
</ul>
<p>Pour le développement avec RStudio :</p>
<ul>
<li><a href="https://support.rstudio.com/hc/en-us/articles/200486488-Developing-Packages-with-RStudio" class="uri">https://support.rstudio.com/hc/en-us/articles/200486488-Developing-Packages-with-RStudio</a></li>
</ul>
<hr />
</div>
<div id="annexe" class="section level1 unnumbered">
<h1>Annexe</h1>
<div id="résolution-de-problèmes-déjà-rencontrés" class="section level2 unnumbered">
<h2>Résolution de problèmes déjà rencontrés</h2>
<p>Voici des problèmes déjà rencontrés par des étudiants du cours lors de la construction ou la vérification d’un package avec RStudio et leurs solutions.</p>
<div id="erreur-installation-failed" class="section level4 unnumbered">
<h4>Erreur « Installation failed »</h4>
<p></p>
<p>PROBLÈME : Une erreur de ce type est produite par l’outil « <strong>Check Package</strong> » :</p>
<pre><code>   * checking whether package &#39;manhattan&#39; can be installed ... ERROR
   Installation failed.
   See &#39;C:/coursR/NomRépertoireAvecAccents/manhattan.Rcheck/00install.out&#39; for details.</code></pre>
<p>CAUSE : Le nom complet du répertoire du package contient des accents ou des espaces. (Cela ne cause pas toujours une erreur, ça dépend de la version de R utilisée et de votre système d’exploitation.)</p>
<p>SOLUTION : Utiliser un répertoire dont le nom complet ne comprend aucun accent, ni aucun espace.</p>
<p> </p>
</div>
<div id="erreur-de-permission-décriture-dans-un-répertoire-dinstallation" class="section level4 unnumbered">
<h4>Erreur de permission d’écriture dans un répertoire d’installation</h4>
<p></p>
<p>PROBLÈME : Une erreur de ce type est produite par l’outil « <strong>Build Binary Package</strong> », « <strong>Install and Restart</strong> » ou « <strong>Clean and Rebuild</strong> » :</p>
<pre><code>   ERREUR\ : pas de permission pour installer dans le répertoire 
   &#39;C:/Program Files/R/R-4.0.3/library&#39;</code></pre>
<p>CAUSE : Le compte utilisé n’a pas la permission d’écrire dans le répertoire où R cherche à installer le package. Si vous travaillez à partir d’un compte administrateur, vous ne devriez pas rencontrer ce problème.</p>
<p>SOLUTION : Modifier les options des outils de construction pour demander l’installation dans un autre répertoire, un pour lequel le compte utilisateur à une permission en écriture.</p>
<p>Étape 1 : trouver le bon répertoire à utiliser</p>
<p>Il faut utiliser un des répertoires dans lesquels R recherche des installations de packages. Un vecteur contenant tous ces répertoires est retourné par la commande suivante dans la console R :</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">.libPaths</span>()</span></code></pre></div>
<pre><code>## [1] &quot;C:/Users/Sophie/Documents/R/win-library/4.0&quot;
## [2] &quot;C:/Program Files/R/R-4.0.3/library&quot;</code></pre>
<p>Dans mon cas, le premier répertoire énuméré, soit <code>"C:/Users/Sophie/Documents/R/win-library/4.0"</code>, est localisé dans les fichiers du compte utilisateur. J’y ai donc assurément une permission en écriture. C’est lui que je vais utiliser.</p>
<p>Étape 2 : ajouter une option aux outils de construction</p>
<ol style="list-style-type: lower-alpha">
<li>ouvrir la fenêtre de configuration des outils de construction</li>
<li>ajouter l’option <code>--library="C:/Users/Sophie/Documents/R/win-library/4.0"</code> (à adapter selon le nom du répertoire que vous avez choisi d’utiliser) à deux endroits :</li>
</ol>
<ul>
<li>la configuration de l’outil « <strong>Install and Restart</strong> » et « <strong>Clean and Rebuild</strong> » se fait dans le champ, nommé « Build and Reload - R CMD INSTALL additionnal options: »</li>
<li>la configuration de l’outil « <strong>Build Binary Package</strong> » se fait dans le dernier champ, nommé « Build Binary Package - R CMD INSTALL additionnal options: »</li>
</ul>
<p> </p>
</div>
<div id="vérification-qui-gèle-à-létape-checking-pdf-version-of-manual" class="section level4 unnumbered">
<h4>Vérification qui gèle à l’étape « checking PDF version of manual »</h4>
<p></p>
<p>PROBLÈME : Outil « <strong>Check Package</strong> » qui n’arrive pas à terminer son check, qui gèle à l’étape « checking PDF version of manual ».</p>
<p>CAUSE : Je ne sais pas exactement… Ça ressemble à un bogue.</p>
<p>SOLUTION : Modifier les options de l’outil « <strong>Check Package</strong> »</p>
<ol style="list-style-type: lower-alpha">
<li>ouvrir la fenêtre de configuration des outils de construction</li>
<li>ajouter dans le champ nommé « Check Package - R CMD check additionnal options: » l’option suivante : <code>--no-manual</code></li>
</ol>
</div>
</div>
</div>
